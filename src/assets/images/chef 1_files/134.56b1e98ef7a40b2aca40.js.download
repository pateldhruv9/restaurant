(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{723:function(e,t,n){(function(r){var i,o;
/*!
 * otherlevels - v1.21.0
 * 2020-07-15
 * HEAD / 63d58c8359c9b7e11d3254074b44a6f1011ad039
 */
!function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,(function(e){return i(t[s][1][e]||e)}),c,c.exports,e,t,n,r)}return n[s].exports}for(var o=!1,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(n,r,i){var s,a;s=this,a=function(){"use strict";var e,t,n;function r(e){return Array.isArray?Array.isArray(e):-1!=e.constructor.toString().indexOf("Array")}function i(e){try{var r=JSON.parse(e.data);if("object"!=typeof r||null===r)throw"malformed"}catch(e){return}var i,o,s,a=e.source,u=e.origin;if("string"==typeof r.method){var c=r.method.split("::");s=2==c.length?(i=c[0],c[1]):r.method}if(void 0!==r.id&&(o=r.id),"string"==typeof s){var l=!1;if(t[u]&&t[u][i])for(var d=0;d<t[u][i].length;d++)if(t[u][i][d].win===a){t[u][i][d].handler(u,s,r),l=!0;break}if(!l&&t["*"]&&t["*"][i])for(d=0;d<t["*"][i].length;d++)if(t["*"][i][d].win===a){t["*"][i][d].handler(u,s,r);break}}else void 0!==o&&n[o]&&n[o](u,s,r)}return e=Math.floor(1000001*Math.random()),t={},n={},window.addEventListener?window.addEventListener("message",i,!1):window.attachEvent&&window.attachEvent("onmessage",i),{build:function(i){function o(e){if(i.debugOutput&&window.console&&window.console.log){try{"string"!=typeof e&&(e=JSON.stringify(e))}catch(e){}window.console.log("["+c+"] "+e)}}if(!window.postMessage)throw"jschannel cannot run this browser, no postMessage";if(!window.JSON||!window.JSON.stringify||!window.JSON.parse)throw"jschannel cannot run this browser, no JSON parsing/serialization";if("object"!=typeof i)throw"Channel build invoked without a proper object argument";if(!i.window||!i.window.postMessage)throw"Channel.build() called without a valid window argument";window===i.window&&o("target window is same as present window -- use at your own risk");var s,a=!1;if("string"==typeof i.origin&&("*"===i.origin?a=!0:null!==(s=i.origin.match(/^https?:\/\/(?:[-a-zA-Z0-9_\.])+(?::\d+)?/))&&(i.origin=s[0].toLowerCase(),a=!0)),!a)throw"Channel.build() called with an invalid origin";if(void 0!==i.scope){if("string"!=typeof i.scope)throw"scope, when specified, must be a string";if(1<i.scope.split("::").length)throw"scope may not contain double colons: '::'"}else i.scope="__default";function u(e,t,s){if("function"==typeof i.gotMessageObserver)try{i.gotMessageObserver(e,s)}catch(e){o("gotMessageObserver() raised an exception: "+e.toString())}if(s.id&&t){p[s.id]={};var a=(w=s.id,S=e,k=s.callbacks?s.callbacks:[],T=E=!1,{origin:S,invoke:function(e,t){if(!p[w])throw"attempting to invoke a callback of a nonexistent transaction: "+w;for(var n=!1,r=0;r<k.length;r++)if(e===k[r]){n=!0;break}if(!n)throw"request supports no such callback '"+e+"'";v({id:w,callback:e,params:t})},error:function(e,t){if(T=!0,!p[w])throw"error called for nonexistent message: "+w;delete p[w],v({id:w,error:e,message:t})},complete:function(e){if(T=!0,!p[w])throw"complete called for nonexistent message: "+w;delete p[w],v({id:w,result:e})},delayReturn:function(e){return"boolean"==typeof e&&(E=!0===e),E},completed:function(){return T}});if(l[t])try{if(s.callbacks&&r(s.callbacks)&&0<s.callbacks.length)for(var u=0;u<s.callbacks.length;u++){for(var c=s.callbacks[u],f=s.params,g=c.split("/"),h=0;h<g.length-1;h++){var m=g[h];"object"!=typeof f[m]&&(f[m]={}),f=f[m]}f[g[g.length-1]]=function(){var e=c;return function(t){return a.invoke(e,t)}}()}var b=l[t](a,s.params);a.delayReturn()||a.completed()||a.complete(b)}catch(t){var y="runtime_error",_=null;if("string"==typeof t?_=t:"object"==typeof t&&(t instanceof Error?(y=t.constructor.name,_=t.message):t&&r(t)&&2==t.length?(y=t[0],_=t[1]):"string"==typeof t.error&&(y=t.error,t.message?"string"==typeof t.message?_=t.message:t=t.message:_="")),null===_)try{void 0===(_=JSON.stringify(t))&&(_=t.toString())}catch(e){_=t.toString()}a.error(y,_)}else a.error("method_not_found","No method '"+t+"' was (yet) bound by the provider")}else s.id&&s.callback?d[s.id]&&d[s.id].callbacks&&d[s.id].callbacks[s.callback]?d[s.id].callbacks[s.callback](s.params):o("ignoring invalid callback, id:"+s.id+" ("+s.callback+")"):s.id?d[s.id]?(s.error?d[s.id].error&&d[s.id].error(s.error,s.message):void 0!==s.result?d[s.id].success(s.result):d[s.id].success(),delete d[s.id],delete n[s.id]):o("ignoring invalid response: "+s.id):t&&l[t]&&l[t]({origin:e},s.params);var w,S,k,E,T}var c=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n=0;n<5;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}(),l={},d={},p={},f=!1,g=[],h=[];function m(e){return[i.scope,e].join("::")}!function(e,n,r,i){function o(t){for(var n=0;n<t.length;n++)if(t[n].win===e)return!0;return!1}var s=!1;if("*"===n){for(var a in t)if(t.hasOwnProperty(a)&&"*"!==a&&"object"==typeof t[a][r]&&(s=o(t[a][r])))break}else t["*"]&&t["*"][r]&&(s=o(t["*"][r])),!s&&t[n]&&t[n][r]&&(s=o(t[n][r]));if(s)throw"A channel is already bound to the same window which overlaps with origin '"+n+"' and has scope '"+r+"'";"object"!=typeof t[n]&&(t[n]={}),"object"!=typeof t[n][r]&&(t[n][r]=[]),t[n][r].push({win:e,handler:i})}(i.window,i.origin,i.scope,u);var v=function(e,t){if(!e)throw"postMessage called with null message";if(t||f){if("function"==typeof i.postMessageObserver)try{i.postMessageObserver(i.origin,e)}catch(e){o("postMessageObserver() raised an exception: "+e.toString())}o("post message: "+JSON.stringify(e)+" with origin "+i.origin),i.window.postMessage(JSON.stringify(e),i.origin)}else o("queue message: "+JSON.stringify(e)),g.push(e)},b=function(e,t){var n;e=[].concat(e);for(var r=0;r<e.length;r++)t[n=e[r].toString()]=function(e){return function(t,n,r){n?y.call({method:e,params:t,success:n,error:r}):y.notify({method:e,params:t})}}(n)},y={remote:{},unbind:function(e,t){if(l[e]){if(!delete l[e])throw"can't delete method: "+e;return i.publish&&!t&&(f?y.notify({method:"__unbind",params:e}):h.push({action:"unbind",method:e})),!0}return!1},bind:function(e,t,n){if(!e||"string"!=typeof e)throw"'method' argument to bind must be string";if(!t||"function"!=typeof t)throw"callback missing from bind params";if(l[e])throw"method '"+e+"' is already bound!";return l[e]=t,i.publish&&!n&&(f?y.notify({method:"__bind",params:e}):h.push({action:"bind",method:e})),this},call:function(t){if(!t)throw"missing arguments to call function";if(!t.method||"string"!=typeof t.method)throw"'method' argument to call must be string";if(!t.success||"function"!=typeof t.success)throw"'success' callback missing from call";var r={},i=[],o=[],s=function(e,t){if(0<=o.indexOf(t))throw"params cannot be a recursive data structure";if(t&&o.push(t),"object"==typeof t)for(var n in t)if(t.hasOwnProperty(n)){var a=e+(e.length?"/":"")+n;"function"==typeof t[n]?(r[a]=t[n],i.push(a),delete t[n]):"object"==typeof t[n]&&s(a,t[n])}};s("",t.params);var a,c,l,p={id:e,method:m(t.method),params:t.params};i.length&&(p.callbacks=i),t.timeout&&(a=e,c=t.timeout,l=m(t.method),window.setTimeout((function(){if(d[a]){var e="timeout ("+c+"ms) exceeded on method '"+l+"'";d[a].error&&d[a].error("timeout_error",e),delete d[a],delete n[a]}}),c)),d[e]={callbacks:r,error:t.error,success:t.success},n[e]=u,e++,v(p)},notify:function(e){if(!e)throw"missing arguments to notify function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to notify must be string";v({method:m(e.method),params:e.params})},destroy:function(){!function(e,n,r){for(var i=t[n][r],o=0;o<i.length;o++)i[o].win===e&&i.splice(o,1);0===t[n][r].length&&delete t[n][r]}(i.window,i.origin,i.scope),window.removeEventListener?window.removeEventListener("message",u,!1):window.detachEvent&&window.detachEvent("onmessage",u),f=!1,l={},p={},d={},i.origin=null,g=[],o("channel destroyed"),c=""}};return y.bind("__ready",(function(e,t){if(o("ready msg received"),f&&!i.reconnect)throw"received ready message while in ready state.";f=!0,c.length<6&&("publish-request"===t.type?c+="-R":c+="-L"),o("ready msg accepted."),"publish-request"===t.type&&y.notify({method:"__ready",params:{type:"publish-reply",publish:h}});for(var n=0;n<t.publish.length;n++)"bind"===t.publish[n].action?b([t.publish[n].method],y.remote):delete y.remote[t.publish[n].method];for(i.reconnect||y.unbind("__ready",!0);g.length;)v(g.splice(0,1)[0]);h=[],"function"==typeof i.onReady&&i.onReady(y)}),!0),y.bind("__bind",(function(e,t){b([t],y.remote)}),!0),y.bind("__unbind",(function(e,t){y.remote[t]&&delete y.remote[t]}),!0),i.remote&&b(i.remote,y.remote),setTimeout((function(){0<c.length&&v({method:m("__ready"),params:{type:"publish-request",publish:h}},!0)}),0),y}}},"object"==typeof i?r.exports=a():void 0===(o=function(){return s.Channel=a()}.apply(t,[]))||(e.exports=o)},{}],2:[function(r,s,a){void 0===(o="function"==typeof(i=function(e,t,n){return function(e,t){"use strict";var n=t||{},r=n.aggressive||!1,i=g(n.sensitivity,20),o=g(n.timer,1e3),s=g(n.delay,0),a=n.callback||function(){},u=h(n.cookieExpire)||"",c=n.cookieDomain?";domain="+n.cookieDomain:"",l=n.cookieName?n.cookieName:"viewedOuibounceModal",d=!0===n.sitewide?";path=/":"",p=null,f=document.documentElement;function g(e,t){return void 0===e?t:e}function h(e){var t=24*e*60*60*1e3,n=new Date;return n.setTime(n.getTime()+t),"; expires="+n.toUTCString()}function m(e){e.clientY>i||(p=setTimeout(w,s))}function v(){p&&(clearTimeout(p),p=null)}setTimeout((function(){_()||(f.addEventListener("mouseleave",m),f.addEventListener("mouseenter",v),f.addEventListener("keydown",y))}),o);var b=!1;function y(e){b||e.metaKey&&76===e.keyCode&&(b=!0,p=setTimeout(w,s))}function _(){return function(e,t){return function(){for(var e=document.cookie.split("; "),t={},n=e.length-1;0<=n;n--){var r=e[n].split("=");t[r[0]]=r[1]}return t}()[e]===t}(l,"true")&&!r}function w(){_()||(e&&(e.style.display="block"),a(),S())}function S(e){var t=e||{};void 0!==t.cookieExpire&&(u=h(t.cookieExpire)),!0===t.sitewide&&(d=";path=/"),void 0!==t.cookieDomain&&(c=";domain="+t.cookieDomain),void 0!==t.cookieName&&(l=t.cookieName),document.cookie=l+"=true"+u+c+d,f.removeEventListener("mouseleave",m),f.removeEventListener("mouseenter",v),f.removeEventListener("keydown",y)}return{fire:w,disable:S,isDisabled:_}}})?i.call(t,n,t,e):i)||(e.exports=o)},{}],3:[function(s,a,u){(function(r){var s;s=function(){var e="object"==typeof self&&self.self===self&&self||"object"==typeof r&&r.global===r&&r||Function("return this")()||{},t=Array.prototype,n=Object.prototype,i="undefined"!=typeof Symbol?Symbol.prototype:null,o=t.push,s=t.slice,a=n.toString,u=n.hasOwnProperty,c=Array.isArray,l=Object.keys,d=Object.create,p=e.isNaN,f=e.isFinite,g=function(){};function h(e){return e instanceof h?e:this instanceof h?void(this._wrapped=e):new h(e)}var m=h.VERSION="1.10.2";function v(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)}}return function(){return e.apply(t,arguments)}}function b(e,t,n){return null==e?rt:Fe(e)?v(e,t,n):(We(e)&&!Be(e)?ot:it)(e)}function y(e,t){return b(e,t,1/0)}function _(e,t,n){return h.iteratee!==y?h.iteratee(e,t):b(e,t,n)}function w(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var o=Array(t+1);for(i=0;i<t;i++)o[i]=arguments[i];return o[t]=r,e.apply(this,o)}}function S(e){if(!We(e))return{};if(d)return d(e);g.prototype=e;var t=new g;return g.prototype=null,t}function k(e){return function(t){return null==t?void 0:t[e]}}function E(e,t){return null!=e&&u.call(e,t)}function T(e,t){for(var n=t.length,r=0;r<n;r++){if(null==e)return;e=e[t[r]]}return n?e:void 0}h.iteratee=y;var I=Math.pow(2,53)-1,P=k("length");function x(e){var t=P(e);return"number"==typeof t&&0<=t&&t<=I}function C(e,t,n){var r,i;if(t=v(t,n),x(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var o=Ee(e);for(r=0,i=o.length;r<i;r++)t(e[o[r]],o[r],e)}return e}function D(e,t,n){t=_(t,n);for(var r=!x(e)&&Ee(e),i=(r||e).length,o=Array(i),s=0;s<i;s++){var a=r?r[s]:s;o[s]=t(e[a],a,e)}return o}function j(e){return function(t,n,r,i){var o=3<=arguments.length;return function(t,n,r,i){var o=!x(t)&&Ee(t),s=(o||t).length,a=0<e?0:s-1;for(i||(r=t[o?o[a]:a],a+=e);0<=a&&a<s;a+=e){var u=o?o[a]:a;r=n(r,t[u],u,t)}return r}(t,v(n,i,4),r,o)}}var L=j(1),O=j(-1);function R(e,t,n){var r=(x(e)?se:Le)(e,t,n);if(void 0!==r&&-1!==r)return e[r]}function N(e,t,n){var r=[];return t=_(t,n),C(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function M(e,t,n){t=_(t,n);for(var r=!x(e)&&Ee(e),i=(r||e).length,o=0;o<i;o++){var s=r?r[o]:o;if(!t(e[s],s,e))return!1}return!0}function A(e,t,n){t=_(t,n);for(var r=!x(e)&&Ee(e),i=(r||e).length,o=0;o<i;o++){var s=r?r[o]:o;if(t(e[s],s,e))return!0}return!1}function U(e,t,n,r){return x(e)||(e=Ie(e)),"number"==typeof n&&!r||(n=0),0<=le(e,t,n)}var q=w((function(e,t,n){var r,i;return Fe(t)?i=t:Be(t)&&(r=t.slice(0,-1),t=t[t.length-1]),D(e,(function(e){var o=i;if(!o){if(r&&r.length&&(e=T(e,r)),null==e)return;o=e[t]}return null==o?o:o.apply(e,n)}))}));function B(e,t){return D(e,it(t))}function W(e,t,n){var r,i,o=-1/0,s=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,u=(e=x(e)?e:Ie(e)).length;a<u;a++)null!=(r=e[a])&&o<r&&(o=r);else t=_(t,n),C(e,(function(e,n,r){i=t(e,n,r),(s<i||i===-1/0&&o===-1/0)&&(o=e,s=i)}));return o}function V(e,t,n){if(null==t||n)return x(e)||(e=Ie(e)),e[st(e.length-1)];var r=(x(e)?Ae:Ie)(e),i=P(r);t=Math.max(Math.min(t,i),0);for(var o=i-1,s=0;s<t;s++){var a=st(s,o),u=r[s];r[s]=r[a],r[a]=u}return r.slice(0,t)}function F(e,t){return function(n,r,i){var o=t?[[],[]]:{};return r=_(r,i),C(n,(function(t,i){var s=r(t,i,n);e(o,t,s)})),o}}var H=F((function(e,t,n){E(e,n)?e[n].push(t):e[n]=[t]})),J=F((function(e,t,n){e[n]=t})),G=F((function(e,t,n){E(e,n)?e[n]++:e[n]=1})),z=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g,K=F((function(e,t,n){e[n?0:1].push(t)}),!0);function Y(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[0]:$(e,e.length-t)}function $(e,t,n){return s.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function Q(e,t,n){return s.call(e,null==t||n?1:t)}function X(e,t,n,r){for(var i=(r=r||[]).length,o=0,s=P(e);o<s;o++){var a=e[o];if(x(a)&&(Be(a)||Ve(a)))if(t)for(var u=0,c=a.length;u<c;)r[i++]=a[u++];else X(a,t,n,r),i=r.length;else n||(r[i++]=a)}return r}var Z=w((function(e,t){return ne(e,t)}));function ee(e,t,n,r){nt(t)||(r=n,n=t,t=!1),null!=n&&(n=_(n,r));for(var i=[],o=[],s=0,a=P(e);s<a;s++){var u=e[s],c=n?n(u,s,e):u;t&&!n?(s&&o===c||i.push(u),o=c):n?U(o,c)||(o.push(c),i.push(u)):U(i,u)||i.push(u)}return i}var te=w((function(e){return ee(X(e,!0,!0))})),ne=w((function(e,t){return t=X(t,!0,!0),N(e,(function(e){return!U(t,e)}))}));function re(e){for(var t=e&&W(e,P).length||0,n=Array(t),r=0;r<t;r++)n[r]=B(e,r);return n}var ie=w(re);function oe(e){return function(t,n,r){n=_(n,r);for(var i=P(t),o=0<e?0:i-1;0<=o&&o<i;o+=e)if(n(t[o],o,t))return o;return-1}}var se=oe(1),ae=oe(-1);function ue(e,t,n,r){for(var i=(n=_(n,r,1))(t),o=0,s=P(e);o<s;){var a=Math.floor((o+s)/2);n(e[a])<i?o=a+1:s=a}return o}function ce(e,t,n){return function(r,i,o){var a=0,u=P(r);if("number"==typeof o)0<e?a=0<=o?o:Math.max(o+u,a):u=0<=o?Math.min(o+1,u):o+u+1;else if(n&&o&&u)return r[o=n(r,i)]===i?o:-1;if(i!=i)return 0<=(o=t(s.call(r,a,u),tt))?o+a:-1;for(o=0<e?a:u-1;0<=o&&o<u;o+=e)if(r[o]===i)return o;return-1}}var le=ce(1,se,ue),de=ce(-1,ae);function pe(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var o=S(e.prototype),s=e.apply(o,i);return We(s)?s:o}var fe=w((function(e,t,n){if(!Fe(e))throw new TypeError("Bind must be called on a function");var r=w((function(i){return pe(e,r,t,this,n.concat(i))}));return r})),ge=w((function(e,t){var n=ge.placeholder,r=function(){for(var i=0,o=t.length,s=Array(o),a=0;a<o;a++)s[a]=t[a]===n?arguments[i++]:t[a];for(;i<arguments.length;)s.push(arguments[i++]);return pe(e,r,this,this,s)};return r}));ge.placeholder=h;var he=w((function(e,t){var n=(t=X(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=fe(e[r],e)}})),me=w((function(e,t,n){return setTimeout((function(){return e.apply(null,n)}),t)})),ve=ge(me,h,1);function be(e){return function(){return!e.apply(this,arguments)}}function ye(e,t){var n;return function(){return 0<--e&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}var _e=ge(ye,2),we=!{toString:null}.propertyIsEnumerable("toString"),Se=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function ke(e,t){var r=Se.length,i=e.constructor,o=Fe(i)&&i.prototype||n,s="constructor";for(E(e,s)&&!U(t,s)&&t.push(s);r--;)(s=Se[r])in e&&e[s]!==o[s]&&!U(t,s)&&t.push(s)}function Ee(e){if(!We(e))return[];if(l)return l(e);var t=[];for(var n in e)E(e,n)&&t.push(n);return we&&ke(e,t),t}function Te(e){if(!We(e))return[];var t=[];for(var n in e)t.push(n);return we&&ke(e,t),t}function Ie(e){for(var t=Ee(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}function Pe(e){for(var t={},n=Ee(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t}function xe(e){var t=[];for(var n in e)Fe(e[n])&&t.push(n);return t.sort()}function Ce(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var o=arguments[i],s=e(o),a=s.length,u=0;u<a;u++){var c=s[u];t&&void 0!==n[c]||(n[c]=o[c])}return n}}var De=Ce(Te),je=Ce(Ee);function Le(e,t,n){t=_(t,n);for(var r,i=Ee(e),o=0,s=i.length;o<s;o++)if(t(e[r=i[o]],r,e))return r}function Oe(e,t,n){return t in n}var Re=w((function(e,t){var n={},r=t[0];if(null==e)return n;Fe(r)?(1<t.length&&(r=v(r,t[1])),t=Te(e)):(r=Oe,t=X(t,!1,!1),e=Object(e));for(var i=0,o=t.length;i<o;i++){var s=t[i],a=e[s];r(a,s,e)&&(n[s]=a)}return n})),Ne=w((function(e,t){var n,r=t[0];return Fe(r)?(r=be(r),1<t.length&&(n=t[1])):(t=D(X(t,!1,!1),String),r=function(e,n){return!U(t,n)}),Re(e,r,n)})),Me=Ce(Te,!0);function Ae(e){return We(e)?Be(e)?e.slice():De({},e):e}function Ue(e,t){var n=Ee(t),r=n.length;if(null==e)return!r;for(var i=Object(e),o=0;o<r;o++){var s=n[o];if(t[s]!==i[s]||!(s in i))return!1}return!0}function qe(e){return function(t){return a.call(t)==="[object "+e+"]"}}var Be=c||qe("Array");function We(e){var t=typeof e;return"function"==t||"object"==t&&!!e}var Ve=qe("Arguments"),Fe=qe("Function"),He=qe("String"),Je=qe("Number"),Ge=qe("Date"),ze=qe("RegExp"),Ke=qe("Error"),Ye=qe("Symbol"),$e=qe("Map"),Qe=qe("WeakMap"),Xe=qe("Set"),Ze=qe("WeakSet");!function(){Ve(arguments)||(Ve=function(e){return E(e,"callee")})}();var et=e.document&&e.document.childNodes;function tt(e){return Je(e)&&p(e)}function nt(e){return!0===e||!1===e||"[object Boolean]"===a.call(e)}function rt(e){return e}function it(e){return Be(e)?function(t){return T(t,e)}:k(e)}function ot(e){return e=je({},e),function(t){return Ue(t,e)}}function st(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}"object"!=typeof Int8Array&&"function"!=typeof et&&(Fe=function(e){return"function"==typeof e||!1});var at=Date.now||function(){return(new Date).getTime()},ut={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},ct=Pe(ut);function lt(e){function t(t){return e[t]}var n="(?:"+Ee(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}}var dt=lt(ut),pt=lt(ct),ft=0;function gt(e){return"\\"+vt[e]}var ht=h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},mt=/(.)^/,vt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},bt=/\\|'|\r|\n|\u2028|\u2029/g;function yt(e,t){return e._chain?h(t).chain():t}function _t(e){return C(xe(e),(function(t){var n=h[t]=e[t];h.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),yt(this,n.apply(h,e))}})),h}C(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var n=t[e];h.prototype[e]=function(){var t=this._wrapped;return n.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0],yt(this,t)}})),C(["concat","join","slice"],(function(e){var n=t[e];h.prototype[e]=function(){return yt(this,n.apply(this._wrapped,arguments))}})),h.prototype.valueOf=h.prototype.toJSON=h.prototype.value=function(){return this._wrapped},h.prototype.toString=function(){return String(this._wrapped)};var wt=_t({default:h,VERSION:m,iteratee:y,restArguments:w,each:C,forEach:C,map:D,collect:D,reduce:L,foldl:L,inject:L,reduceRight:O,foldr:O,find:R,detect:R,filter:N,select:N,reject:function(e,t,n){return N(e,be(_(t)),n)},every:M,all:M,some:A,any:A,contains:U,includes:U,include:U,invoke:q,pluck:B,where:function(e,t){return N(e,ot(t))},findWhere:function(e,t){return R(e,ot(t))},max:W,min:function(e,t,n){var r,i,o=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,u=(e=x(e)?e:Ie(e)).length;a<u;a++)null!=(r=e[a])&&r<o&&(o=r);else t=_(t,n),C(e,(function(e,n,r){((i=t(e,n,r))<s||i===1/0&&o===1/0)&&(o=e,s=i)}));return o},shuffle:function(e){return V(e,1/0)},sample:V,sortBy:function(e,t,n){var r=0;return t=_(t,n),B(D(e,(function(e,n,i){return{value:e,index:r++,criteria:t(e,n,i)}})).sort((function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(r<n||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index})),"value")},groupBy:H,indexBy:J,countBy:G,toArray:function(e){return e?Be(e)?s.call(e):He(e)?e.match(z):x(e)?D(e,rt):Ie(e):[]},size:function(e){return null==e?0:x(e)?e.length:Ee(e).length},partition:K,first:Y,head:Y,take:Y,initial:$,last:function(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[e.length-1]:Q(e,Math.max(0,e.length-t))},rest:Q,tail:Q,drop:Q,compact:function(e){return N(e,Boolean)},flatten:function(e,t){return X(e,t,!1)},without:Z,uniq:ee,unique:ee,union:te,intersection:function(e){for(var t=[],n=arguments.length,r=0,i=P(e);r<i;r++){var o=e[r];if(!U(t,o)){var s;for(s=1;s<n&&U(arguments[s],o);s++);s===n&&t.push(o)}}return t},difference:ne,unzip:re,zip:ie,object:function(e,t){for(var n={},r=0,i=P(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},findIndex:se,findLastIndex:ae,sortedIndex:ue,indexOf:le,lastIndexOf:de,range:function(e,t,n){null==t&&(t=e||0,e=0),n=n||(t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),o=0;o<r;o++,e+=n)i[o]=e;return i},chunk:function(e,t){if(null==t||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(s.call(e,r,r+=t));return n},bind:fe,partial:ge,bindAll:he,memoize:function(e,t){var n=function(r){var i=n.cache,o=""+(t?t.apply(this,arguments):r);return E(i,o)||(i[o]=e.apply(this,arguments)),i[o]};return n.cache={},n},delay:me,defer:ve,throttle:function(e,t,n){var r,i,o,s,a=0;function u(){a=!1===n.leading?0:at(),r=null,s=e.apply(i,o),r||(i=o=null)}function c(){var c=at();a||!1!==n.leading||(a=c);var l=t-(c-a);return i=this,o=arguments,l<=0||t<l?(r&&(clearTimeout(r),r=null),a=c,s=e.apply(i,o),r||(i=o=null)):r||!1===n.trailing||(r=setTimeout(u,l)),s}return n=n||{},c.cancel=function(){clearTimeout(r),a=0,r=i=o=null},c},debounce:function(e,t,n){function r(t,n){i=null,n&&(o=e.apply(t,n))}var i,o,s=w((function(s){if(i&&clearTimeout(i),n){var a=!i;i=setTimeout(r,t),a&&(o=e.apply(this,s))}else i=me(r,t,this,s);return o}));return s.cancel=function(){clearTimeout(i),i=null},s},wrap:function(e,t){return ge(t,e)},negate:be,compose:function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:ye,once:_e,keys:Ee,allKeys:Te,values:Ie,mapObject:function(e,t,n){t=_(t,n);for(var r=Ee(e),i=r.length,o={},s=0;s<i;s++){var a=r[s];o[a]=t(e[a],a,e)}return o},pairs:function(e){for(var t=Ee(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},invert:Pe,functions:xe,methods:xe,extend:De,extendOwn:je,assign:je,findKey:Le,pick:Re,omit:Ne,defaults:Me,create:function(e,t){var n=S(e);return t&&je(n,t),n},clone:Ae,tap:function(e,t){return t(e),e},isMatch:Ue,isEqual:function(e,t){return function e(t,n,r,o){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return!1;if(t!=t)return n!=n;var s=typeof t;return("function"==s||"object"==s||"object"==typeof n)&&function(t,n,r,o){t instanceof h&&(t=t._wrapped),n instanceof h&&(n=n._wrapped);var s=a.call(t);if(s!==a.call(n))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+t==""+n;case"[object Number]":return+t!=+t?+n!=+n:0==+t?1/t==1/n:+t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object Symbol]":return i.valueOf.call(t)===i.valueOf.call(n)}var u="[object Array]"===s;if(!u){if("object"!=typeof t||"object"!=typeof n)return!1;var c=t.constructor,l=n.constructor;if(c!==l&&!(Fe(c)&&c instanceof c&&Fe(l)&&l instanceof l)&&"constructor"in t&&"constructor"in n)return!1}o=o||[];for(var d=(r=r||[]).length;d--;)if(r[d]===t)return o[d]===n;if(r.push(t),o.push(n),u){if((d=t.length)!==n.length)return!1;for(;d--;)if(!e(t[d],n[d],r,o))return!1}else{var p,f=Ee(t);if(d=f.length,Ee(n).length!==d)return!1;for(;d--;)if(!E(n,p=f[d])||!e(t[p],n[p],r,o))return!1}return r.pop(),o.pop(),!0}(t,n,r,o)}(e,t)},isEmpty:function(e){return null==e||(x(e)&&(Be(e)||He(e)||Ve(e))?0===e.length:0===Ee(e).length)},isElement:function(e){return!(!e||1!==e.nodeType)},isArray:Be,isObject:We,isArguments:Ve,isFunction:Fe,isString:He,isNumber:Je,isDate:Ge,isRegExp:ze,isError:Ke,isSymbol:Ye,isMap:$e,isWeakMap:Qe,isSet:Xe,isWeakSet:Ze,isFinite:function(e){return!Ye(e)&&f(e)&&!p(parseFloat(e))},isNaN:tt,isBoolean:nt,isNull:function(e){return null===e},isUndefined:function(e){return void 0===e},has:function(e,t){if(!Be(t))return E(e,t);for(var n=t.length,r=0;r<n;r++){var i=t[r];if(null==e||!u.call(e,i))return!1;e=e[i]}return!!n},identity:rt,constant:function(e){return function(){return e}},noop:function(){},property:it,propertyOf:function(e){return null==e?function(){}:function(t){return Be(t)?T(e,t):e[t]}},matcher:ot,matches:ot,times:function(e,t,n){var r=Array(Math.max(0,e));t=v(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},random:st,now:at,escape:dt,unescape:pt,result:function(e,t,n){Be(t)||(t=[t]);var r=t.length;if(!r)return Fe(n)?n.call(e):n;for(var i=0;i<r;i++){var o=null==e?void 0:e[t[i]];void 0===o&&(o=n,i=r),e=Fe(o)?o.call(e):o}return e},uniqueId:function(e){var t=++ft+"";return e?e+t:t},templateSettings:ht,template:function(e,t,n){!t&&n&&(t=n),t=Me({},t,h.templateSettings);var r,i=RegExp([(t.escape||mt).source,(t.interpolate||mt).source,(t.evaluate||mt).source].join("|")+"|$","g"),o=0,s="__p+='";e.replace(i,(function(t,n,r,i,a){return s+=e.slice(o,a).replace(bt,gt),o=a+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":i&&(s+="';\n"+i+"\n__p+='"),t})),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{r=new Function(t.variable||"obj","_",s)}catch(t){throw t.source=s,t}function a(e){return r.call(this,e,h)}var u=t.variable||"obj";return a.source="function("+u+"){\n"+s+"}",a},chain:function(e){var t=h(e);return t._chain=!0,t},mixin:_t});return wt._=wt},"object"==typeof u&&void 0!==a?a.exports=s():void 0===(o="function"==typeof(i=s)?i.call(t,n,t,e):i)||(e.exports=o)}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,n){var r=e("./v1"),i=e("./v4"),o=i;o.v1=r,o.v4=i,t.exports=o},{"./v1":7,"./v4":8}],5:[function(e,t,n){for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var n=t||0;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}},{}],6:[function(e,t,n){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var i=new Uint8Array(16);t.exports=function(){return r(i),i}}else{var o=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},{}],7:[function(e,t,n){var r,i,o=e("./lib/rng"),s=e("./lib/bytesToUuid"),a=0,u=0;t.exports=function(e,t,n){var c=t&&n||0,l=t||[],d=(e=e||{}).node||r,p=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==p){var f=o();null==d&&(d=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==p&&(p=i=16383&(f[6]<<8|f[7]))}var g=void 0!==e.msecs?e.msecs:(new Date).getTime(),h=void 0!==e.nsecs?e.nsecs:u+1,m=g-a+(h-u)/1e4;if(m<0&&void 0===e.clockseq&&(p=p+1&16383),(m<0||a<g)&&void 0===e.nsecs&&(h=0),1e4<=h)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=g,i=p;var v=(1e4*(268435455&(g+=122192928e5))+(u=h))%4294967296;l[c++]=v>>>24&255,l[c++]=v>>>16&255,l[c++]=v>>>8&255,l[c++]=255&v;var b=g/4294967296*1e4&268435455;l[c++]=b>>>8&255,l[c++]=255&b,l[c++]=b>>>24&15|16,l[c++]=b>>>16&255,l[c++]=p>>>8|128,l[c++]=255&p;for(var y=0;y<6;++y)l[c+y]=d[y];return t||s(l)}},{"./lib/bytesToUuid":5,"./lib/rng":6}],8:[function(e,t,n){var r=e("./lib/rng"),i=e("./lib/bytesToUuid");t.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},{"./lib/bytesToUuid":5,"./lib/rng":6}],9:[function(e,t,n){(function(e){!function(){"use strict";function n(){}function r(e){var t,r=this;if(!k(r)||r._s!==i)throw D("Invalid this");if(r._s=h,e!==n){if(!E(e))throw D(v);(t=P(e)(M(r,g),M(r,f)))===y&&U(r,f,t.e)}}var i,o,s,a=null,u="object"==typeof self,c=u?self:e,l=c.Promise,d=c.process,p=Array,f=0,g=1,h=2,m="species",v="Invalid argument",b="unhandledRejection",y={e:a},_=c.Symbol||{},w=u?function(e){l?new l((function(e){e()})).then(e):setTimeout(e)}:d.nextTick;function S(){return _[m]||"Symbol(species)"}function k(e){return e&&"object"==typeof e}function E(e){return"function"==typeof e}function T(e,t,n){if(!t(e))throw D(n)}function I(){try{return o.apply(s,arguments)}catch(e){return y.e=e,y}}function P(e,t){return o=e,s=t,I}function x(e,t){var n=p(e),r=0;function o(){for(var o=0;o<r;)t(n[o],n[o+1]),n[o++]=i,n[o++]=i;r=0,n.length>e&&(n.length=e)}return function(e,t){n[r++]=e,n[r++]=t,2===r&&w(o)}}function C(e,t){var n,r,i,o,s=0;if(!e)throw D(v);var a=e[_.iterator];if(E(a))r=a.call(e);else{if(!E(e.next)){if(e instanceof p){for(n=e.length;s<n;)t(e[s],s++);return s}throw D(v)}r=e}for(;!(i=r.next()).done;)if((o=P(t)(i.value,s++))===y)throw E(r.return)&&r.return(),o.e;return s}function D(e){return new TypeError(e)}(function(e,t){for(var n in t)e.prototype[n]=t[n]})(r.default=r,{then:function(e,t){if(void 0===this._s)throw D();return function(e,t,n,r){return E(n)&&(t._onFulfilled=n),E(r)&&(e._uh&&O("rejectionHandled",e),t._onRejected=r),e[e._pCount++]=t,e._s!==h&&j(e,t),t}(this,N((n=r,(i=this.constructor)&&i[S()]||n)),e,t);var n,i},catch:function(e){return this.then(i,e)},finally:function(e){return this.then((function(t){return r.resolve(e()).then((function(){return t}))}),(function(t){return r.resolve(e()).then((function(){throw t}))}))},_pCount:0,_pre:a,_Yaku:1}),r.resolve=function(e){return R(e)?e:q(N(this),e)},r.reject=function(e){return U(N(this),f,e)},r.race=function(e){function t(e){U(i,g,e)}function n(e){U(i,f,e)}var r=this,i=N(r),o=P(C)(e,(function(e){r.resolve(e).then(t,n)}));return o===y?r.reject(o.e):i},r.all=function(e){var t,n=this,r=N(n),i=[];function o(e){U(r,f,e)}return(t=P(C)(e,(function(e,s){n.resolve(e).then((function(e){i[s]=e,--t||U(r,g,i)}),o)})))===y?n.reject(t.e):(t||U(r,g,[]),r)},P((function(){Object.defineProperty(r,S(),{get:function(){return this}})}))(),r._Yaku=1;var j=x(999,(function(e,t){var n,r;(r=e._s?t._onFulfilled:t._onRejected)!==i?(n=P(A)(r,e._v))!==y?q(t,n):U(t,f,n.e):U(t,e._s,e._v)})),L=x(9,(function(e){!function e(t){if(t._umark)return!0;t._umark=!0;for(var n,r=0,i=t._pCount;r<i;)if((n=t[r++])._onRejected||e(n))return!0}(e)&&(e._uh=1,O(b,e))}));function O(e,t){var n="on"+e.toLowerCase(),r=c[n];d&&d.listeners(e).length?e===b?d.emit(e,t._v,t):d.emit(e,t):r&&r({reason:t._v,promise:t})}function R(e){return e&&e._Yaku}function N(e){return R(e)?new e(n):(t=new e((function(e,n){if(t)throw D();r=e,i=n})),T(r,E),T(i,E),t);var t,r,i}function M(e,t){var n=!1;return function(r){n||(n=!0,t===g?q(e,r):U(e,t,r))}}function A(e,t){return e(t)}function U(e,t,n){var r=0,i=e._pCount;if(e._s===h)for(e._s=t,e._v=n,t===f&&L(e);r<i;)j(e,e[r++]);return e}function q(e,t){if(t===e&&t)return U(e,f,D("Chaining cycle detected for promise")),e;if(t!==a&&(E(t)||k(t))){var n=P(B)(t);if(n===y)return U(e,f,n.e),e;E(n)?R(t)?W(e,t,n):w((function(){W(e,t,n)})):U(e,g,t)}else U(e,g,t);return e}function B(e){return e.then}function W(e,t,n){var r=P(n,t)((function(n){t&&(t=a,q(e,n))}),(function(n){t&&(t=a,U(e,f,n))}));r===y&&t&&(U(e,f,r.e),t=a)}try{t.exports=r}catch(u){c.Yaku=r}}()}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],10:[function(e,t,n){!function(r){"use strict";var i=e("./services/logging"),o=e("./platform"),s=e("./services/admin"),a=e("./services/session"),u=e("./services/event"),c=e("./services/tag"),l=e("./services/notification"),d=e("./services/richinbox"),p=e("./services/push"),f=e("./services/permission"),g=e("./services/tracing"),h=e("./services/preload"),m=e("./utils");function v(e){return function(t){i.error("["+e+"] Unexpected error: "+t.message)}}function b(){this.settings={}}function y(){this.settings={}}function _(){this.settings={}}function w(e,t,n){return this.settings={},this.admin=new _,this.rims=new b,this.push=new y,this.initialize(e,t,n),this}if(b.prototype={initialize:function(e){this.settings=e},onMessagesUpdated:function(e){d.onMessagesUpdated(this.settings,e)},getNewMessages:function(e,t){d.getNewMessages(this.settings,e,t)},getMoreMessages:function(e,t){d.getMoreMessages(this.settings,e,t)},getMessages:function(e){d.getMessages(this.settings,e)},markAsRead:function(e,t){d.markAsRead(this.settings,e,t)},markAsDeleted:function(e,t){d.markAsDeleted(this.settings,e,t)}},y.prototype={initialize:function(e){this.settings=e},isSupported:function(e){p.isPushSupported(this.settings,e)},subscribe:function(e){p.subscribeToPush(this.settings,e)},unsubscribe:function(e){p.unsubscribeFromPush(this.settings,e)},isSubscribed:function(e){p.isSubscribedToPush(this.settings,e)}},_.prototype={initialize:function(e){this.settings=e},enableTracing:function(e){i.info("Executing enableTracing routine."),s.enableTracing(this.settings,e)},disableTracing:function(e){i.info("Executing disableTracing routine."),s.disableTracing(this.settings,e)},debug:function(e){i.info("Executing debug routine. Retrieving SDK configuration."),s.debug(this.settings,e)},reset:function(e){i.info("resetting OL");var t=this;a.getSessionId(this.settings)&&a.endSession(this.settings,(function(){p.isSubscribedToPush(t.settings,(function(n){n?p.unsubscribeFromPush(t.settings,(function(){o.reset(),t.settings.data.tracking_id=null,t.settings.data.prev_tracking_id=null,t.settings.data.phash=null,t.settings.data.sid=null,i.info("OL reset complete - remember to reset your notification permissions in your browser."),e&&e()})):(o.reset(),t.settings.data.tracking_id=null,t.settings.data.prev_tracking_id=null,t.settings.data.phash=null,t.settings.data.sid=null,i.info("OL reset complete - remember to reset your notification permissions in your browser."),e&&e())}))}))}},w.version="1.21.0",w.environment="production",w.LOG_LEVELS=i.LOG_LEVELS,w.prototype={initialize:function(t,n,r){if(!t||0===t.length)throw new Error("OL: appKey is required!");(n=n||{}).multipleSubdomains=void 0!==n.baseDomain&&null!==n.baseDomain,o.initializeStorage(n),this.settings=e("./settings").refreshSettings(w.version,t,n,this.settings),this.admin.initialize(this.settings),this.rims.initialize(this.settings),this.push.initialize(this.settings),this.admin.initialize(this.settings),i.logLevel=this.settings.logLevel,o.initialize(this),i.info("OtherLevels initialized for ",t);var s=n.multipleSubdomains?"enabled":"disabled";i.debug("Multiple subdomain support is "+s+". Base domain is "+n.baseDomain),n.crossOriginReceiverMode&&p.setUpRemoteReceiver(),n.crossOriginReceiverMode||this.startSession(r)},startSession:function(e){var t=this.settings;a.startSession(this.settings,(function(){t.preloadContent?(g.trace(t,"startSession","info","Requesting preload of interstitial(s)."),h.clearCachedInterstitials(t,(function(){h.preloadInterstitials(t)}))):g.trace(t,"startSession","info","Not requesting preload of interstitial(s)."),p.migrateSubscription(t),e&&e.apply(null,arguments)}))},getSessionId:function(e){var t=a.getSessionId(this.settings);return e&&e(t),t},endSession:function(e){a.endSession(this.settings,e)},getAppKey:function(e){var t=this.settings.data.app_key;return e&&e(t),t},registerEvent:function(e,t,n){u.registerEvent(this.settings,e,t,n)},setTrackingId:function(t,n){var r=e("./services/tracking"),i=m.getValidTrackingId(t);if(void 0===i)throw new Error("Could not apply trackingId. Invalid trackingId supplied: "+t);var o=this.settings,s=r.getTrackingId(o),a=this;r.setTrackingId(this.settings,i,(function(){if(s!==i&&(d.clear(o),p.isPushSupported(o,(function(e){e&&p.isSubscribedToPush(o,(function(e){e&&p.updateTrackingId(o,s,i)}))})),o.preloadContent&&h.clearCachedInterstitials(o,(function(){h.preloadInterstitials(o)}))),n){var e=Array.prototype.slice.call(arguments,0);n.apply(a,e)}}))},getTrackingId:function(t){var n=e("./services/tracking").getTrackingId(this.settings);return t&&t(n),n},setTag:function(e,t,n,r){return c.setTag(this.settings,e,t,n,r)},batchSetTag:function(e,t){return c.batchSetTag(this.settings,e,t)},getTag:function(e,t){return c.getTag(this.settings,e,t)},splitTestNotification:function(e,t,n){l.splitTestNotification(this.settings,e,t,n)},showSimpleModal:function(e,t,n,r,i){l.showSimpleModal(e,t,n,r,i)},showSplitTestAlert:function(e,t,n,r,i,o){l.splitTestNotification(this.settings,e,t,(function(e,t,s){var a=n;"function"==typeof n&&(a=n(t)),l.showSimpleModal(e,a,r,(function(){s(),i&&i()}),(function(){o&&o()}))}))},displayInterstitial:function(e,t,n,r,i,o){l.displayInterstitial(this.settings,e,t,n,r,i,o)},preloadInterstitial:function(e,t,n,r,i,o){h.preloadInterstitial(this.settings,e,t,n,r,i,o)},setPhash:function(e,t){a.setPhash(this.settings,e),t&&t()},askForPermission:function(e,t,n){f.askForPermission(this.settings,e,t,n)},getTraceEvents:function(e,t){var n,r;r=t?(n=e,t):e,g.readCachedTraceEvents(this.settings,n).then(r,v("getTraceEvents"))},clearTraceEvents:function(e){g.clearTraceEvents().then(e,v("clearTraceEvents"))}},void 0!==n&&(void 0!==t&&t.exports?t.exports=w:n.OtherLevels=w),void 0!==r&&r){var S=r.OtherLevelsObject||"_ol";r[S]=e("./platform/browser/driver.js")(w,r[S])}}("undefined"!=typeof window?window:null)},{"./platform":24,"./platform/browser/driver.js":11,"./services/admin":25,"./services/event":26,"./services/logging":27,"./services/notification":28,"./services/permission":29,"./services/preload":30,"./services/push":31,"./services/richinbox":32,"./services/session":33,"./services/tag":34,"./services/tracing":35,"./services/tracking":36,"./settings":37,"./utils":40}],11:[function(e,t,n){var r=e("underscore");t.exports=function(t,n){var i,o=e("../../services/logging.js");function s(){var n=arguments[0];if("function"!=typeof n){var r,a,u=Array.prototype.slice.call(arguments,1);switch(n){case"get":var c,l=e("../../utils/");return i&&(c=l.getDeep(i,u[0])),c=c||l.getDeep(t,u[0]),2===u.length&&"function"==typeof u[1]&&u[1](c),c;case"create":return void(void 0!==i?(a=u,"function"==typeof i.initialize&&i.initialize.apply(i,a)):(r=u,d.prototype=t.prototype,i=new d));default:i?function(e,t,n){for(var r,i,o=(t||"").split("."),s=0;s<o.length;s++)r=(i=i?r:e)[o[s]];return"function"==typeof r&&(r.apply(i,n),1)}(i,n,u)||o.debug("Unknown function called: '"+n+"'."):o.error("The OtherLevels object has not been initialised yet.")}}else n(s);function d(){return t.apply(this,r)}}function a(e){for(var t=0;t<e.length;t++)s.apply(s,e[t])}return function(){if(n&&n.q){var e=r.partition(n.q,(function(e){return"create"===e[0]})),t=e[0],i=t.length;if(1<=i){var u=t[0];1<i&&(o.warn("'create' was called more than once during initialisation. Only the first 'create' call will be executed."),t.splice(1));var c=u[u.length-1];if("function"==typeof c)return u[u.length-1]=function(){a(e=e[1]),c()},s.apply(s,u)}a(e=r.flatten(e,!0))}}(),s}},{"../../services/logging.js":27,"../../utils/":40,underscore:3}],12:[function(e,t,n){t.exports={dispatchInternalEvent:function(e){if(window.document){var t=document.createEvent("Event");t.initEvent(e,!0,!0),document.dispatchEvent(t)}}}},{}],13:[function(e,t,n){var r=e("jschannel"),i=e("../../utils"),o=i.Promise;function s(e,t){this.url=e,this.id="ol-remote-id",this.scope=t,this._channel=null,this.timeout=1e3}function a(e,t){return function(){var n=Array.prototype.slice.call(arguments,0);return e.send(t,n)}}function u(e,t){return function(n,r){e[t].apply(e,r).then((function(e){n.complete(e)}),(function(e){n.error(e)})),n.delayReturn(!0)}}s.prototype._set=function(e){this._channel=e},s.prototype._get=function(e){if(null===this._channel){var t=window.document.getElementById(this.id),n=this;if(t)if(t.onload||e(new Error('"onload" method missing on iframe')),t.loaded)this._channel=r.build({window:t.contentWindow,origin:"*",scope:this.scope,reconnect:!0}),e(null,this._channel);else var i=setInterval((function(){n._channel&&(e(null,n._channel),clearInterval(i))}),100);else(t=window.document.createElement("iframe")).setAttribute("src",this.url),t.setAttribute("id",this.id),t.setAttribute("visibility","hidden"),t.style="width: 0px; height: 0px; border:0px; display:none;",t.onload=function(){t.loaded=!0,n._set(r.build({window:t.contentWindow,origin:"*",scope:n.scope})),e(null,n._channel)},document.getElementsByTagName("body")[0].appendChild(t)}else e(null,this._channel)},s.prototype.send=function(e,t){var n=this;return new o((function(r,o){n._get((function(s,a){if(s)o(s);else{var u=[];for(var c in t)u.push(i.deepCopy(t[c]));a.call({method:e,params:u,success:function(e){r(e)},error:o,timeout:n.timeout})}}))}))},t.exports={proxySenderObject:function(e,t,n){var r={_iframeSender:new s(t,n)};for(var i in e)e.hasOwnProperty(i)&&(r[i]=a(r._iframeSender,i));return r},proxyReceiverObject:function(e,t){var n={_channel:r.build({window:window.parent,origin:"*",scope:t,reconnect:!0}),_obj:e};for(var i in e)e.hasOwnProperty(i)&&n._channel.bind(i,u(e,i))}}},{"../../utils":40,jschannel:1}],14:[function(e,t,n){var r=e("./storage.js"),i=e("./modal.js"),o=e("./push/");window.console||(window.console={});var s={_configuredStorage:null,iframeProxy:e("./iframeProxy.js"),_formatError:function(e){var t;try{t=JSON.parse(e.message)}catch(e){}return{type:"api",message:t&&t.error?t.error:e.message,url:e.url,responseJSON:t,statusCode:e.statusCode}},logger:function(){function e(e){var t=window.console[e];return function(){void 0===t.apply?t(Array.prototype.slice.call(arguments).join(" ")):t.apply(window.console,arguments)}}for(var t={log:e("log"),debug:e("log")},n=["info","warn","error","debug"],r=0;r<n.length;r++){var i=n[r];window.console[i]?t[i]=e(i):t[i]=e("log")}return t},initializeStorage:function(e){s._configuredStorage=r.getStorage(e)},initialize:function(){s.log=e("../../services/logging"),s.log.info(s._configuredStorage)},http:{_sendRequest:function(t,n,r,i,o){i||(r={payload:JSON.stringify(r)}),e("./xhr.js")[t](n,r,i,(function(e){var t;if(e.responseText)try{t=JSON.parse(e.responseText)}catch(e){}t?s.log.debug("Received JSON: ",t):s.log.debug("Received text: ",e.responseText),o&&o(null,t||e.responseText)}),(function(e){o&&o(s._formatError(e))}))},post:function(e,t,n,r){s.http._sendRequest("post",e,t,n,r)},put:function(e,t,n,r){s.http._sendRequest("put",e,t,n,r)},get:function(e,t,n,r){s.http._sendRequest("get",e,null,!0,r)},delete:function(e,t,n,r){s.http._sendRequest("delete",e,t,n,r)}},platformSettings:function(){var e=navigator.language||navigator.userLanguage,t=(new Date).getTimezoneOffset();return t=t<0?"+"+-t:"-"+t,{data:{language:e.substring(0,2),timezone:t,cookiesEnabled:navigator.cookieEnabled}}},getStoredValue:function(e){return s._configuredStorage.get(e)},setStoredValue:function(e,t,n){s._configuredStorage.set(e,t,n)},clearStoredValue:function(e){s._configuredStorage.set(e)},getPhashFromHashFragment:function(e){e=e||"phash=";var t=new RegExp(e+"(.{6,12})$"),n=t.exec(window.location.hash);return n?(window.location.hash=window.location.hash.replace(t,""),n[1]):""},showSimpleModal:function(e,t,n,r,o){new i({confirmButtonLabel:n,onConfirm:r,onDismiss:o}).show(e,t)},showEmptyModal:function(e,t,n,r){var o=new i({showConfirmButton:!1,showHeader:!1,onDismiss:r,extraClasses:e,eventHandlers:n});return o.show(t),o},applyModalTrigger:function(t,n,r){s.log.debug("applying modal trigger."),e("./modalTrigger.js").setModalTriggerStrategy(t,n,r)},push:{isSupported:o.isSupported,supportsVAPIDWebPush:o.supportsVAPIDWebPush,isHttpWebPushSupported:o.isHttpWebPushSupported,requiresDeliverabilityDelete:o.requiresDeliverabilityDelete,subscribe:function(e){return o.register(e,s._configuredStorage)},unsubscribe:function(e){return o.unregister(e,s.getBrowserName(),s._configuredStorage)},isSubscribed:function(e){return o.isRegistered(e,s._configuredStorage)},getSubscriptionDetails:function(e){return o.getSubscriptionDetails(e,s._configuredStorage)},getCurrentDeliveryDetails:function(e){return o.getCurrentDeliveryDetails(e)},saveSubscriptionDetails:function(e,t){return o.saveSubscriptionDetails(e,s._configuredStorage,t)},removeSubscriptionDetails:function(e){return o.removeSubscriptionDetails(e,s._configuredStorage)},getNotificationPermission:function(e){return o.getNotificationPermission(e,s._configuredStorage)},getLastPushMessage:o.getLastPushMessage,peekLastPushMessage:o.peekLastPushMessage,setTracingId:o.setTracingId,setTracingEnabled:o.setTracingEnabled,setTracingDisabled:o.setTracingDisabled,readTraceEvents:o.readTraceEvents,clearTraceEvents:o.clearTraceEvents,getServiceWorkerConfig:o.getServiceWorkerConfig,saveRecipientDetails:o.saveRecipientDetails},getOLParametersFromQueryString:function(e){(e=e||{}).phashParamName=e.phashParamName||"_olph",e.trackingIdParamName=e.trackingIdParamName||"_oltid",e.sessionIdParamName=e.sessionIdParamName||"_olsid";var t=Object.create(null);return window.location.search.trim().replace(/^(\?|#|&)/,"").split("&").forEach((function(e){var n=e.replace(/\+/g," ").split("="),r=n.shift(),i=0<n.length?n.join("="):void 0;r=decodeURIComponent(r),i=void 0===i?null:decodeURIComponent(i),void 0===t[r]?t[r]=i:Array.isArray(t[r])?t[r].push(i):t[r]=[t[r],i]})),{phash:t[e.phashParamName],trackingId:t[e.trackingIdParamName],sessionId:t[e.sessionIdParamName]}},getBrowserName:function(){var e=-1!==navigator.userAgent.toLowerCase().indexOf("chrome"),t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");return-1===navigator.userAgent.toLowerCase().indexOf("safari")||e?window.chrome||e?"chrome":t?"firefox":void 0:"safari"},getUserAgentHeader:function(){return navigator.userAgent},getOLScriptUrls:function(){var e=[];if(window.document)for(var t=document.getElementsByTagName("script"),n=0;n<t.length;n++)t[n].src&&0<t[n].src.indexOf("otherlevels")&&e.push(t[n].src);return e},reset:function(){r.reset()},dispatchInternalEvent:function(t){e("./eventDispatcher.js").dispatchInternalEvent(t)}};t.exports={logger:s.logger,initialize:s.initialize,initializeStorage:s.initializeStorage,http:{post:s.http.post,put:s.http.put,get:s.http.get,delete:s.http.delete},push:s.push,reset:s.reset,platformSettings:s.platformSettings,getStoredValue:s.getStoredValue,setStoredValue:s.setStoredValue,clearStoredValue:s.clearStoredValue,getPhashFromHashFragment:s.getPhashFromHashFragment,showSimpleModal:s.showSimpleModal,showEmptyModal:s.showEmptyModal,applyModalTrigger:s.applyModalTrigger,getOLParametersFromQueryString:s.getOLParametersFromQueryString,iframeProxy:s.iframeProxy,getBrowserName:s.getBrowserName,getUserAgentHeader:s.getUserAgentHeader,getOLScriptUrls:s.getOLScriptUrls,dispatchInternalEvent:s.dispatchInternalEvent}},{"../../services/logging":27,"./eventDispatcher.js":12,"./iframeProxy.js":13,"./modal.js":15,"./modalTrigger.js":16,"./push/":17,"./storage.js":21,"./xhr.js":23}],15:[function(e,t,n){var r=e("../../utils");function i(e){e=e||{},this._id=e.id||"ol-"+(new Date).getTime()+Math.round(100*Math.random()),this._confirmButtonLabel=e.confirmButtonLabel||"OK",this._showCloseButton=void 0===e.showCloseButton||e.showCloseButton,this._onDismiss=e.onDismiss,this._onConfirm=e.onConfirm,this._showConfirmButton=void 0===e.showConfirmButton||e.showConfirmButton,this._extraClasses=e.extraClasses||[];var t=this;e.eventHandlers&&(t._eventHandlers={},r.forEachInObject(e.eventHandlers,(function(e,n){t._eventHandlers[e]=function(e){var r={};r.close=t._closeModal,n(e,r)}}))),this._showModal=function(e){e.className=e.className.replace(/(?:^|\s)ol-hide(?!\S)/g,""),this._emitEvent("ol-modal-show")},this._closeModal=function(){t.close(),t=void 0},this._bindButtonClick=function(e,t,n){if(e){e.innerHTML||(e.innerHTML=t);var r=this;e.onclick=function(){r.close(),n&&n()}}},this._showHeader=void 0===e.showHeader||e.showHeader,this._bindConfirmButton=function(e){this._bindButtonClick(e,this._confirmButtonLabel,this._onConfirm)},this._bindCloseButton=function(e){this._bindButtonClick(e,"&times;",this._onDismiss)},this._attachOrRemoveEvents=function(e){if(this._eventHandlers&&this._eventHandlers!=={}){var t="attach"===e?this._addEventListener:this._removeEventListener;r.forEachInObject(this._eventHandlers,(function(e,n){var r=e.split(" "),i=r[0],o=r[1],s=document.getElementById(o);s&&t(s,i,n)}))}},this._attachEvents=function(){this._attachOrRemoveEvents("attach")},this._removeEvents=function(){this._attachOrRemoveEvents("remove")},this.show=function(e,t){var n=document.createElement("div");n.innerHTML=e;var r=this._findElementByClass(n,"ol-modal");if(r)this._bindCloseButton(this._findElementByClass(r,"ol-close")),this._bindConfirmButton(this._findElementByClass(r,"ol-confirm"));else{r=this._newElement("div","ol-modal "+this._extraClasses.join(" "));var i=this._newElement("div","ol-content",r);if((t||this._showCloseButton)&&this._showHeader){var o=this._newElement("div","ol-header",i);if(t&&(this._newElement("div","ol-title",o).innerHTML=t),this._showCloseButton&&this._bindCloseButton(this._newElement("div","ol-close",o)),this._showConfirmButton){var s=this._newElement("div","ol-footer",i);this._bindConfirmButton(this._newElement("div","ol-confirm",s))}}else if(!this._showHeader&&this._showCloseButton){var a=this._newElement("div","ol-close",i);this._bindCloseButton(a)}this._newElement("div","ol-body",i).innerHTML=e}return r.id=this._id,document.body.firstChild.parentNode.insertBefore(r,document.body.firstChild),this._attachEvents(),this._emitEvent("ol-modal-create"),r},this.close=function(){var e=this,t=document.getElementById(this._id);this._emitEvent("ol-modal-hide"),this._hideModal(t),setTimeout((function(){e._emitEvent("ol-modal-remove"),e._removeEvents(),t.parentNode&&t.parentNode.removeChild(t),t=null}),500)}}i.prototype._findElementByClass=function(e,t){return e.getElementsByClassName?e.getElementsByClassName(t)[0]:e.querySelector("."+t)},i.prototype._hideModal=function(e){e.className+=" ol-hide"},i.prototype._emitEvent=function(e,t){var n;"function"==typeof CustomEvent?n=new CustomEvent(e,t):(n=document.createEvent("CustomEvent")).initEvent(e,!0,!0),n&&document.dispatchEvent(n)},i.prototype._addEventListener=function(e,t,n,r){n&&(e.addEventListener?e.addEventListener(t,n,!r):e.attachEvent&&e.attachEvent("on"+t,n))},i.prototype._removeEventListener=function(e,t,n){n&&(e.removeEventListener?e.removeEventListener(t,n,!0):e.attachEvent&&e.detachEvent("on"+t,n))},i.prototype._newElement=function(e,t,n){var r=document.createElement(e);return r.className=t,n&&n.appendChild(r),r},t.exports=i},{"../../utils":40}],16:[function(e,t,n){var r=e("./eventDispatcher"),i=e("ouibounce");function o(e,t){return e.getAttribute(t)||(0===t.indexOf("data-")?e.getAttribute(t.substring(5)):e.getAttribute("data-"+t))}function s(e,t){return setTimeout((function(){t()}),100),"immediate-trigger"}t.exports={setModalTriggerStrategy:function(e,t,n){var a=e.trace||function(){},u=document.createElement("html"),c=document.createElement("body");c.innerHTML=t,u.appendChild(c);var l,d=u.childNodes[0].firstChild;switch(o(d,"ol-trigger")){case"exit-intent":return a("modal.trigger.strategy","info","Trigger strategy for modal content is exit-intent"),r.dispatchInternalEvent("Preload-Exit-Intent-Trigger-Applied"),l=n,i(!1,{cookieExpire:0,callback:function(){l()}}),"exit-intent-trigger";case"timed":return a("modal.trigger.strategy","info","Trigger strategy for modal content is timed"),r.dispatchInternalEvent("Preload-Timed-Trigger-Applied"),function(e,t){var n=o(e,"ol-trigger-delay");if(!n)return s(0,t);var r=parseInt(n,10);return r?(setTimeout((function(){t()}),1e3*r),"timer-trigger"):s(0,t)}(d,n);default:return a("modal.trigger.strategy","info","Trigger strategy for modal content is immediate"),r.dispatchInternalEvent("Preload-Immediate-Trigger-Applied"),"immediate-trigger"}}}},{"./eventDispatcher":12,ouibounce:2}],17:[function(e,t,n){var r=e("./safari-support.js");t.exports=r.supportsPushNotification()?e("./safari.js"):e("./w3c.js")},{"./safari-support.js":18,"./safari.js":19,"./w3c.js":20}],18:[function(e,t,n){var r={supportsPushNotification:function(){return"safari"in window&&"pushNotification"in window.safari}};t.exports={supportsPushNotification:r.supportsPushNotification}},{}],19:[function(e,t,n){var r=e("../../../utils/").Promise,i=e("./safari-support.js");t.exports={isSupported:function(){var e=i.supportsPushNotification();return r.resolve(e)},isHttpWebPushSupported:function(){return r.resolve(!0)},requiresDeliverabilityDelete:function(){return r.resolve(!1)},getSubscriptionDetails:function(e){var t=window.safari.pushNotification.permission(e.safariWebsitePushId);return t&&t.deviceToken?r.resolve({deviceToken:t.deviceToken}):r.resolve()},saveSubscriptionDetails:function(){return r.resolve()},removeSubscriptionDetails:function(){return r.resolve()},register:function(e){var t=e.trace||function(){},n=e.server.jsSdkService+"/safari",i=e.safariWebsitePushId,o=e.data.app_key,s=e.data.tracking_id;return i?function e(a){return"default"===a.permission?(t("push.subscribe.safari","info","Requesting push notification permission on Safari.",{webserviceUrl:n,websitePushID:i,payload:{appKey:o,trackingId:s}}),new r((function(t,r){try{window.safari.pushNotification.requestPermission(n,i,{appKey:o,trackingId:s},(function(n){e(n).then(t,r)}))}catch(e){r(e)}}))):"granted"===a.permission?(t("push.subscribe.safari","info","Push notification permission granted on Safari.",{websitePushID:i}),r.resolve({platform:"safari",websitePushId:i,deviceToken:a.deviceToken})):"denied"===a.permission?(t("push.subscribe.safari","info","Push notification permission denied on Safari.",{websitePushID:i}),r.reject(new Error("Push notification permission denied for this website."))):r.reject(new Error('Unknown push notification permission: "'+a.permission+'".'))}(window.safari.pushNotification.permission(i)):r.reject(new Error('Cannot request push notification permission without a valid "safariWebsitePushId".'))},unregister:function(){return r.resolve()},isRegistered:function(e){if(e.safariWebsitePushId){var t=window.safari.pushNotification.permission(e.safariWebsitePushId);return r.resolve("granted"===t.permission)}return r.reject(new Error('Cannot check push notification permission without a valid "safariWebsitePushId".'))},getNotificationPermission:function(e){var t=e.safariWebsitePushId;if(t){var n=window.safari.pushNotification.permission(t);return r.resolve(n.permission)}return r.reject(new Error('Cannot check push notification permission without a valid "safariWebsitePushId".'))},getCurrentDeliveryDetails:function(){return r.resolve()},getLastPushMessage:function(){return r.resolve()},peekLastPushMessage:function(){return r.resolve()},setTracingId:function(){return r.resolve()},setTracingEnabled:function(){return r.resolve()},setTracingDisabled:function(){return r.resolve()},readTraceEvents:function(){return r.resolve([])},clearTraceEvents:function(){return r.resolve([])},saveRecipientDetails:function(){return r.resolve()},supportsVAPIDWebPush:function(){return!1},getServiceWorkerConfig:function(){return r.resolve({status:"not supported on Safari"})}}},{"../../../utils/":40,"./safari-support.js":18}],20:[function(e,t,n){var r,i,o=e("../../../utils/browserpush.js"),s=e("../../../utils/index.js"),a=s.Promise,u="last_message",c="app_key",l="tracking_id",d=o.traceDbName,p="OL_last_permission",f="OL_SubscriptionEndpoint";function g(){return r=r||new o.IndexedDBWrapper("ol-service-worker",1)}function h(){return!i&&o.isIndexedDBSupported()&&(i=new o.IndexedDBWrapper(d,1,{autoIncrement:!0})),i}function m(){return window.location!==window.parent.location}function v(e,t){var n=g();return n.put(c,e).then((function(){return n.put(l,t)}))}function b(e,t){return g().put(e,t)}t.exports={isSupported:function(){var e=window.PushManager||navigator.push,t=window.Notification,n=navigator.serviceWorker,r=!!(e&&t&&n),i=!!document.documentMode,o=!i&&!!window.StyleMedia;return a.resolve(r&&!(i||o))},isHttpWebPushSupported:function(){return a.resolve(!1)},requiresDeliverabilityDelete:function(){return a.resolve(!0)},getSubscriptionDetails:function(e,t){var n=t.get(f);return n?a.resolve({subscriptionUrl:n}):a.resolve()},saveSubscriptionDetails:function(e,t,n){return new a((function(e,r){try{t.set(f,n.subscriptionUrl,s.getLongTermExpiry()),e()}catch(e){r(e)}}))},removeSubscriptionDetails:function(e,t){return new a((function(e,n){try{t.set(f,null),e()}catch(e){n(e)}}))},register:function(e,t){var n=e.trace||function(){};return s.executeWithPromise(window.Notification.requestPermission).then((function(r){if(t.set(p,r,s.getLongTermExpiry()),n("push.subscribe.permission","info",'Notification permissions are "'+r+'".',{permission:r}),"granted"===r)return i=e.serviceWorkerLocation,a=e.serviceWorkerScope,u=e.vapidPublicKey,n("push.subscribe.worker","info","Registering worker",{workerPath:i,workerOptions:c={scope:a,updateViaCache:"none"}}),navigator.serviceWorker.register(i,c).then((function(){return navigator.serviceWorker.ready})).then((function(e){return e.update()})).then((function(e){var t={userVisibleOnly:!0};return void 0!==u&&(t={userVisibleOnly:!0,applicationServerKey:s.urlBase64ToUint8Array(u)}),e.pushManager.subscribe(t).then(null,(function(e){throw"denied"===window.Notification.permission?new Error("User permanently disabled permissions for this website."):e}))})).then((function(t){n("push.subscribe.worker","info","Registered worker and got subscription");var r=o.getDeliveryDetails(t);return r.isVapid=void 0!==e.vapidPublicKey,r})).then(void 0,(function(e){throw n("push.subscribe.worker","error","Error while registering worker",{error:e.message,stack:e.stack}),e}));throw"denied"===r?(n("push.subscribe.permission","info","Notification permissions are denied.",{permission:r}),new Error("User permanently disabled permissions for this website")):new Error("User ignored permission request for this website. Subscription attempt can be repeated");var i,a,u,c})).then((function(t){return v(e.data.app_key,e.data.tracking_id).then((function(){return t}))}))},unregister:function(e,t,n){var r=e.trace||function(){};return(!m()||"chrome"!==t&&"firefox"!==t?navigator.serviceWorker.ready.then((function(e){if(e.active)return e.pushManager.getSubscription().then((function(e){if(e){var t=o.getDeliveryDetails(e);return e.unsubscribe().then((function(){return r("push.unsubscribe.pushSubscription","info","platform push - subscription found and unsubscribed.",t),t}))}r("push.unsubscribe.pushSubscription","info","Could not find pushSubscription.")}));r("push.unsubscribe.service-worker","info","Could not find service worker registration.")})):new a((function(e){r("push.unsubscribe.chrome","info","Returning stored subscription URL for Chrome.");var t=n.get(f);"undefined"!==t&&null!==t?e({subscriptionUrl:t}):e()}))).then((function(e){return n.set(p,null),(t=g()).delete(c).then((function(){return t.delete(l)})).then((function(){return e}));var t}))},isRegistered:function(e,t){var n=e.trace||function(){};return navigator.serviceWorker&&navigator.serviceWorker.ready?m()?g().get("sw_keepalive_timestamp").then((function(e){return!e||parseInt(e,10)+6048e5<(new Date).getTime()})).catch((function(){return!0})).then((function(e){var r="granted"===t.get(p)&&!e;return n("push.isRegistered.iFrame.permission","info",'Notification permissions are "'+window.Notification.permission+'".',{permission:window.Notification.permission}),n("push.isRegistered.iFrame","info",'isReadyToResubscribe: "'+e+'".',{isReady:e}),r}),(function(e){return n("push.isRegistered.iFrame.error","info","Error with push.isRegistered in iFrame. Handling this as if the user is not subscribed.",{error:e}),!1})):navigator.serviceWorker.getRegistration(e.serviceWorkerScope).catch((function(){return!!navigator.serviceWorker.ready})).then((function(e){return!(!e||!e.active)&&e.pushManager.permissionState({userVisibleOnly:!0}).then((function(t){return"granted"===t&&e.pushManager.getSubscription().catch((function(){return!1})).then((function(e){return!!e}))}))})):(n("push.isRegistered.noserviceworker","info","isRegistered found no service worker support."),a.resolve(!1))},getNotificationPermission:function(e,t){var n=e.trace||function(){};if(Notification&&Notification.permission){var r=Notification.permission;if(m()){var i=t.get(p);n("push.getNotificationPermission.iFrame","info",'permission: "'+(r="undefined"!==i&&null!==i?i:"default")+'".',{iFrame:m(),browserPermission:Notification.permission,storedPermission:i})}return a.resolve(r)}return a.reject(new Error("Notification permissions not supported"))},getCurrentDeliveryDetails:function(e){var t=e.trace||function(){};return t("push.getCurrentDeliveryDetails","info","Executing details lookup."),navigator.serviceWorker.ready.then((function(e){return e.active?e.pushManager.getSubscription().then((function(e){return e?(t("push.getCurrentDeliveryDetails.pushSubscription","info","Found pushSubscription, returning delivery details."),a.resolve(o.getDeliveryDetails(e))):(t("push.getCurrentDeliveryDetails.pushSubscription","info","Could not find pushSubscription."),a.resolve({}))})):(t("push.getCurrentDeliveryDetails.service-worker","info","Could not find service worker registration with attempting to retrieve delivery details."),a.resolve())}))},getLastPushMessage:function(){return g().get(u).then((function(e){return g().delete(u),e})).catch((function(){g().delete(u)}))},peekLastPushMessage:function(){return g().get(o.lastMessageReceivedKey).then((function(e){return e}))},setTracingId:function(e){return b(o.tracingIdStorageKey,e)},setTracingEnabled:function(){return b(o.tracingEnabledKey,!0)},setTracingDisabled:function(){return e=o.tracingEnabledKey,g().delete(e);var e},readTraceEvents:function(){var e=h();return e?e.getAll().then((function(e){return e.map((function(e){return JSON.parse(e)}))})):a.resolve([])},clearTraceEvents:function(){var e=h();return e?e.clear().then((function(){})):a.resolve()},getServiceWorkerConfig:function(){if(navigator.serviceWorker&&navigator.serviceWorker.controller){var e=navigator.serviceWorker.ready.then((function(e){if(e){var t=g(),n=["oldSubscription","newSubscription","endpoint","payload"],r=n.map((function(e){return t.get("ol-sw.subscription-change."+e).catch((function(e){return"could not get: "+e.message}))}));return a.all(r).then((function(e){return n.reduce((function(t,n,r){return t[n]=e[r],t}),{})})).then((function(t){var n={scope:e.scope,subscriptionChangeTrace:t};return e.active?e.pushManager.getSubscription().then((function(t){return n.subscriptionEndpoint=t?t.endpoint:"undefined",n.status=e.active.state,n.scriptURL=e.active.scriptURL,n})):(e.installing?(n.status=e.installing.state,n.scriptURL=e.installing.scriptURL):e.waiting&&(n.status=e.waiting.state,n.scriptURL=e.waiting.scriptURL),n)}))}return{status:"no service worker registration present"}}));return new a((function(t,n){var r=!1;e.then((function(e){r=!0,t(e)}),(function(e){r=!0,n(e)})),setTimeout((function(){r||t({status:"not ready"})}),7e3)}))}return a.resolve({status:"not installed"})},saveRecipientDetails:function(e,t){return v(e,t)},supportsVAPIDWebPush:function(){return!0}}},{"../../../utils/browserpush.js":38,"../../../utils/index.js":40}],21:[function(e,t,n){var r=e("../../utils/index.js"),i="ol-",o=null,s="ol-exp-",a={set:function(e,t,n){""===t||null==t?(window.localStorage.removeItem(s+e),window.localStorage.removeItem(e)):(window.localStorage.setItem(e,t),n?window.localStorage.setItem(s+e,n.getTime()):window.localStorage.removeItem(s+e))},get:function(e){var t=window.localStorage.getItem(e),n=window.localStorage.getItem(s+e);return null===t?null:n&&new Date(parseInt(n)).getTime()<(new Date).getTime()?(window.localStorage.removeItem(e),window.localStorage.removeItem(s+e),null):t},clear:function(){window.localStorage.clear()},isSupported:function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}(),name:"localstorage"},u={setDomain:function(e){o=e},set:function(e,t,n){var r=i+e+"="+(""===t||null==t?"":t)+";path=/";n&&(r+=";expires="+n.toGMTString()),o&&"localhost"!==o&&(r+=";domain="+o),document.cookie=r},get:function(e){for(var t=i+e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(o.substring(0,t.length)===t){var s=o.substring(t.length,o.length);return""===s?null:s}}return null},clear:function(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var n=e[t].trim();if(n.substring(0,i.length)===i){var o=r.arrayIndexOf(n,"="),s=-1<o?n.substr(i.length,o-i.length):n;u.set(s,"",new Date(-1))}}e=document.cookie.split(";")},migrateLocalStorageData:function(e,t){var n=window.location.hostname;if(a.isSupported){var i,o,c=[];for(i=0;i<window.localStorage.length;i++)if(null!==(o=window.localStorage.key(i))&&o.substring(0,7)!==s&&"OL_"===o.substring(0,3)){var l=window.localStorage.getItem(o);if(c.push(o),null!==l&&(null===u.get(o)||n===t)){var d=window.localStorage.getItem(s+o);d=null!==d?new Date(parseInt(d)):r.getLongTermExpiry(),u.set(o,l,d)}}for(i=0;i<c.length;i++)a.set(c[i],null)}},isSupported:!0,name:"cookiestorage"};(u.alternativeStorage=a).alternativeStorage=u,t.exports={getStorage:function(e){if(void 0!==e&&e.multipleSubdomains||!a.isSupported){var t=u;e.multipleSubdomains&&t.setDomain(e.baseDomain);var n=void 0===e.dataMigrationSubdomain?e.primarySubdomain:e.dataMigrationSubdomain;return t.migrateLocalStorageData(e.baseDomain,n),t}return a},reset:function(){u.clear(),a.isSupported&&a.clear()},localStorage:a,cookieStorage:u}},{"../../utils/index.js":40}],22:[function(e,t,n){function r(){this._init()}r.prototype._init=function(){this.executingRequest=null,this.queue=[],this.retryAttemptCount=0,this.retryDelaysInSeconds=[1,1,2,3,5,8,13]},r.prototype._sendRequest=function(t){e("../../platform/").http[t.method.toLowerCase()](t.url,t.data,t.asJson,this._onDone(t))},r.prototype._dispatchRequest=function(e){if(e){if(this.executingRequest&&e!==this.executingRequest)return void this.queue.push(e)}else e=this.queue.shift();if(this.executingRequest=e||null,e){var t=this.retryAttemptCount?this.retryDelaysInSeconds[this.retryAttemptCount-1]:0;if(t){var n=this;setTimeout((function(){n._sendRequest(e)}),1e3*t)}else this._sendRequest(e)}},r.prototype._createRequest=function(e,t,n){var r=n;return r.method=e,r.url=t,r},r.prototype.dispatchDeleteRequest=function(e,t){var n=this._createRequest("delete",e,t);this._dispatchRequest(n)},r.prototype.dispatchGetRequest=function(e,t){var n=this._createRequest("get",e,t);this._dispatchRequest(n)},r.prototype.dispatchPostRequest=function(e,t){var n=this._createRequest("post",e,t);this._dispatchRequest(n)},r.prototype.dispatchPutRequest=function(e,t){var n=this._createRequest("put",e,t);this._dispatchRequest(n)},r.prototype._onDone=function(e){var t=this;return function(n,r){if(n){e.onError&&e.onError(n);var i=n.statusCode;0===i||500<=i?(t.retryAttemptCount<t.retryDelaysInSeconds.length&&t.retryAttemptCount++,t._dispatchRequest(e)):t._dispatchRequest()}else e.onSuccess&&e.onSuccess(r),0<t.retryAttemptCount&&t.retryAttemptCount--,t._dispatchRequest()}},t.exports=new r},{"../../platform/":24}],23:[function(e,t,n){var r=e("underscore"),i={_urlEncodeObject:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},_sendRequest:function(e,t,n,o,s,a){var u;try{u=new window.XMLHttpRequest}catch(e){return void(a&&a(e))}u.open(e,t,!window.__adapter__);var c=o?"application/json":"application/x-www-form-urlencoded";u.setRequestHeader("Content-Type",c+"; charset=UTF-8"),u.setRequestHeader("X-Requested-With","XMLHttpRequest"),n&&r.isObject(n)&&(n=o?JSON.stringify(n):i._urlEncodeObject(n)),u.onreadystatechange=function(){4===u.readyState&&function(){if(200<=u.status&&u.status<300)s&&s(u);else if(a){var e=new Error(0!==u.status||u.responseText?u.responseText||"API response status: "+u.status:"Could not connect to the API");e.statusCode=u.status,e.url=t,a(e)}}()},u.send(n||null)},post:function(e,t,n,r,o){i._sendRequest("POST",e,t,n,r,o)},put:function(e,t,n,r,o){i._sendRequest("PUT",e,t,n,r,o)},get:function(e,t,n,r,o){i._sendRequest("GET",e,null,!0,r,o)},delete:function(e,t,n,r,o){i._sendRequest("DELETE",e,t,n,r,o)}};t.exports={post:i.post,put:i.put,get:i.get,delete:i.delete}},{underscore:3}],24:[function(e,t,n){t.exports=e("./browser")},{"./browser":14,"./mock":void 0,"./titanium":void 0}],25:[function(e,t,n){var r=e("../platform"),i=e("./push"),o=e("./logging"),s=e("./tracing"),a=e("../utils"),u={enableTracing:function(e,t){e.tracingEnabled=!0,s.enableTracing(e),s.trace(e,"tracer.enabled","info","Tracer enabled on page",location),a.isHTTPS()||a.isLocalhost()||o.info("WARNING: Dynamically enabling tracing in an HTTP cross-origin configuration may inadvertently modify the tracing settings of the remote service worker."),r.setStoredValue("OL_TraceEnabled",e.tracingEnabled,a.getLongTermExpiry()),t&&t(e.tracingEnabled)},disableTracing:function(e,t){function n(){r.setStoredValue("OL_TraceEnabled",e.tracingEnabled,a.getLongTermExpiry()),t&&t(e.tracingEnabled)}e.tracingEnabled=!1,a.isHTTPS()||a.isLocalhost()||o.info("WARNING: Dynamically disabling tracing in an HTTP cross-origin configuration may inadvertently modify the tracing settings of the remote service worker."),s.disableTracing(e).then(n,n)},debug:function(t,n){var o=e("./tracking"),s={};i.isPushSupported(t,(function(e){i.isSubscribedToPush(t,(function(a){i.getNotificationPermission(t,(function(u){i.getServiceWorkerConfig(t).then((function(c){i.peekLastPushMessage(t).then((function(i){var l=r.getStoredValue("OL_WEB_DEVICE_ID"),d=r.getStoredValue("OL_VAPID_migration_on");return s={app:{app_key:t.data.app_key,app_name:t.data.app_name,last_install_time:t.data.lit,last_clean_install_time:t.data.acit,version:t.data.lv},user_data:{current_phash:t.data.phash,tracking_id:o.getTrackingId(t),prev_tracking_id:t.data.prev_tracking_id,session_id:t.data.sid,session_length_ms:t.data.session_length,average_session_length_ms:t.data.average_session_length,web_device_id:l},web_push:{is_supported:e,is_subscribed:a,notification_permission:u,last_push_message:i,vapid_public_key:t.vapidPublicKey,vapid_migration_on:d},service_worker:c,configuration:{session_expiration_seconds:t.sessionExpirationSeconds,notification_yes_url:t.permissionUrls.notificationYes,cross_origin_receiver_url:t.crossOriginReceiverUrl,cross_origin_receiver_mode:t.crossOriginReceiverMode,multiple_subdomains:t.multipleSubdomains,primary_subdomain:t.primarySubdomain,data_migration_subdomain:t.dataMigrationSubdomain,preload_content:t.preloadContent,safari_website_push_id:t.safariWebsitePushId},endpoints:t.server,platformSettings:function(){var e=r.platformSettings().data,t={};if(t.browser=r.getBrowserName(),r.getUserAgentHeader&&(t.user_agent=r.getUserAgentHeader()),r.getOLScriptUrls&&(t.ol_scripts=r.getOLScriptUrls()),"undefined"!==e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}()},n&&n(s),s}))}))}))}))}))}};t.exports={debug:u.debug,enableTracing:u.enableTracing,disableTracing:u.disableTracing}},{"../platform":24,"../utils":40,"./logging":27,"./push":31,"./tracing":35,"./tracking":36}],26:[function(e,t,n){var r={registerEvent:function(t,n,r,i,o){var s=e("./logging.js"),a=e("./tracking.js"),u=e("../platform/browser/xhr-queue.js");s.info("registerEvent",n,r);var c={acit:t.data.acit,app_key:t.data.app_key,event_label:r,event_type:n,language:t.data.language,lit:t.data.lit,lv:t.data.lv,phash:t.data.phash,prev_tracking_id:t.data.prev_tracking_id,sid:t.data.sid,tracking_id:a.getTrackingId(t)};o&&(c.phash=o);var l=t.server.apiEndpoint+"/register_app_event";u.dispatchPostRequest(l,{data:c,onSuccess:i,onError:t.onError})}};t.exports={registerEvent:r.registerEvent}},{"../platform/browser/xhr-queue.js":22,"./logging.js":27,"./tracking.js":36}],27:[function(e,t,n){var r=e("../platform/").logger(),i={debug:1,info:2,warn:3,error:4,off:5},o={LOG_LEVELS:i,logLevel:i.warn,debug:function(){o.logLevel<=i.debug&&o.performLog("DEBUG",r.debug,Array.prototype.slice.call(arguments))},info:function(){o.logLevel<=i.info&&o.performLog("INFO",r.info,Array.prototype.slice.call(arguments))},warn:function(){o.logLevel<=i.warn&&o.performLog("WARN",r.warn,Array.prototype.slice.call(arguments))},error:function(){o.logLevel<=i.error&&o.performLog("ERROR",r.error,Array.prototype.slice.call(arguments))},trace:function(){o.performLog("INFO",r.info,Array.prototype.slice.call(arguments))},performLog:function(t,n,i){if(r&&r.log){var o="",s=e("../utils/");s.isTopWindow()||(o="("+s.getPageUrl()+")"),i.unshift("OL "+o+"["+t+"]:"),(n||r.log).apply(r,i)}}};t.exports=o},{"../platform/":24,"../utils/":40}],28:[function(e,t,n){var r=e("./logging.js"),i=e("../platform/"),o=e("./event.js"),s=e("./session.js"),a=e("./tracking.js"),u=e("../platform/browser/xhr-queue.js"),c={markInterstitialAsDisplayed:function(e,t){var n={phash:t.phash,templateId:t.templateid,splitId:t.splitid},o=e.server.contentEndpoint+"/"+e.data.app_key+"/"+a.getTrackingId(e)+"/interstitial/v2/mark-displayed";i.dispatchInternalEvent("Mark-Displayed"),u.dispatchPostRequest(o,{data:n,asJson:!0,onSuccess:function(){r.debug("Successfully marked interstitial as displayed.")},onError:function(t){r.error("Error marking interstitial as displayed.",t),e.onError&&e.onError(t)}})},receivedPushNotification:function(e,t){s.setPhash(e,t.p)},splitTestNotification:function(e,t,n,i){if(t&&n&&i){var o={pushtext:t,campaigntoken:n,responsetype:"json",realtime_filtering:!0},c=a.getTrackingId(e);c&&(o.trackingid=c),e.data.phash&&(o.phash=e.data.phash);var l=e.server.mdnEndpoint+"/message/analytics";u.dispatchPostRequest(l,{data:o,asJson:!0,onSuccess:function(t){if(t&&0!==t.errorcode){var n=t.errorinfo?t.errorinfo:"Unexpected error received";r.error("Error while getting split test notification",n),e.onError&&e.onError(n)}else if(t){var o=decodeURIComponent(t.messagetext),a=t.messagecontent,u=t.phash,c={settings:e,phash:u};r.info("Received text for split test notification:",o),i(o,a,(function(){s.setPhash(c.settings,c.phash),c=null,r.info("User accepted notification")}))}else r.info("No result received")},onError:function(t){r.error("Error while getting split test notification"),e.onError&&e.onError(t)}})}else r.error("method signature is incorrect")},displayInterstitial:function(t,n,l,d,p,f,g){function h(a,u){if(r.debug("Received interstitial",a),a&&a.message){function g(){s.setPhash(y.settings,y.phash),r.info("Pushed new phash.",y.phash),y=null}var h=a.message.phash,m=JSON.parse(decodeURIComponent(a.message.messagecontent)),v=m.subject.replace(/\s+/g,"-").toLowerCase(),b=decodeURIComponent(m.html),y={settings:t,phash:h},_=e("../utils/"),w={};_.forEachInObject(l,(function(e,n){w[e]=function(r,i){var s=e.split(/\s+/),a=_.capitalize(s[0]),u=s[1];o.registerEvent(t,a,{id:u},null,h),(i=i||{}).pushPhash=g,i.meta=m,n(r,i)}}));var S=i.showEmptyModal(["ol-interstitial",v],b,w,(function(){o.registerEvent(t,"Close",{},null,h),d&&d({meta:m})}));p&&p({phash:h,modal:S,meta:m}),i.dispatchInternalEvent("Interstitial-Displayed"),e("./tracing.js").trace(t,"notification.interstitial.display","info","Ready to mark as displayed if cached.",{cached:u}),u&&(i.clearStoredValue("OL-Content-"+n),c.markInterstitialAsDisplayed(t,a.message))}else f&&f()}var m=i.getStoredValue("OL-Content-"+n);if(m)h(JSON.parse(m),!0);else{var v={placement:n};if(g&&void 0!==g.displayGroup){var b=isNaN(parseInt(g.displayGroup,10))?void 0:parseInt(g.displayGroup,10);v.displayGroup=b}var y=t.server.contentEndpoint+"/"+t.data.app_key+"/"+a.getTrackingId(t)+"/interstitial/v2/fetch?preload=false";u.dispatchPostRequest(y,{data:v,asJson:!0,onSuccess:h,onError:function(e){r.error("Error getting interstitial",e),t.onError&&t.onError(e)}})}},showSimpleModal:function(e,t,n,r,o){i.showSimpleModal(e,t,n,r,o)}};t.exports={receivedPushNotification:c.receivedPushNotification,splitTestNotification:c.splitTestNotification,showSimpleModal:c.showSimpleModal,displayInterstitial:c.displayInterstitial}},{"../platform/":24,"../platform/browser/xhr-queue.js":22,"../utils/":40,"./event.js":26,"./logging.js":27,"./session.js":33,"./tracing.js":35,"./tracking.js":36}],29:[function(e,t,n){var r=e("./push"),i=e("./notification"),o=e("./logging"),s=e("./event"),a=e("../utils"),u=e("./tracing"),c={"notification-prompt-no":function(e,t){o.debug("user declined soft opt-in"),t&&t("notification-prompt-no")},"notification-prompt-yes":function(t,n){var i=e("./tracking");if(t.permissionUrls.notificationYes){var o=a.updateUrlParameter(t.permissionUrls.notificationYes,"_oltid",i.getTrackingId(t));t.data.sid&&(o=a.updateUrlParameter(o,"_olsid",t.data.sid)),void 0!==t.tracingEnabled&&(o=a.updateUrlParameter(o,"tracingEnabled",t.tracingEnabled)),u.trace(t,"permission.soft-opt-in.pop-up","info","Displaying pop-up to finalise web push subscription.",{url:o,popupOptions:t.popupOptions});var s=window.open(o,"",t.popupOptions),c=function(){null!==s&&s.closed?(u.trace(t,"permission.soft-opt-in.pop-up","info","Pop-up has been closed."),r.isSubscribedToPush(t,(function(e){e?u.trace(t,"permission.soft-opt-in.subscribed","info","Subscribed to web push."):u.trace(t,"permission.soft-opt-in.subscribed","info","Browser push subscription unsuccessful."),n(e?"subscribed":"notsubscribed")}))):setTimeout(c,2e3)};setTimeout(c,2e3)}else u.trace(t,"permission.soft-opt-in.subscribe","info","Finalising subscription on current domain."),r.subscribeToPush(t,(function(e){var t=void 0!==e&&"Delivery Details updated"===e.response?"subscribed":"notsubscribed";n(t)}))},"notification-settings-yes":function(e,t){-1!==navigator.userAgent.indexOf("Chrome")?(u.trace(e,"permission.soft-opt-in.settings","info","Displaying settings info in another tab.",{url:e.permissionSettingsUrls.chrome}),window.open(e.permissionSettingsUrls.chrome).onbeforeunload=function(){t()}):setTimeout((function(){u.trace(e,"permission.soft-opt-in.settings","info","Displaying settings info in another tab.",{url:e.permissionSettingsUrls.firefox}),window.open(e.permissionSettingsUrls.firefox).onbeforeunload=function(){t()}}),100)}},l="Notification Settings",d={_processPermissionAction:function(e,t,n,r,i){return function(){var n=r.replace("/","");o.info("Permission action "+n+" clicked"),u.trace(e,"permission.soft-opt-in.click","info","Button clicked in interstitial",{action:n}),s.registerEvent(e,n,{},null,t.phash);var a=c[n];return a?(o.debug("Function found for action"),a(e,i)):i&&i(),t.modal.close(),!1}},_onLoaded:function(e,t,n){s.registerEvent(e,"notification-prompt-displayed",{},null,t.phash);for(var r=/otherlevels:\/\/(.*)/i,i=document.links,a=i.length,u=0;u<a;u++){var c=r.exec(i[u].href);c&&(o.debug("Found otherlevels scheme link in document with action"+c[1]),i[u].onclick=d._processPermissionAction(e,t,i[u],c[1],n))}},_askForNotificationPermission:function(e,t,n){o.debug("About to check for notification permission"),r.isPushSupported(e,(function(s){if(!s)return u.trace(e,"permission.ask","info","Web push is not supported. Doing nothing."),o.info("Push is not supported, take no action"),n("push not supported");r.getNotificationPermission(e,(function(s){function p(t){d._onLoaded(e,t,n)}r.isSubscribedToPush(e,(function(r){"default"===s||"granted"===s&&!r||"granted"===s&&!a.isHTTPS()?(o.info("Prompting for Interstitial with placement ",t),u.trace(e,"permission.soft-opt-in","info","Permission: "+s+"; isSubscribed: "+r+". Displaying soft opt-in interstitial."),i.displayInterstitial(e,t,{},(function(){}),p,(function(){u.trace(e,"permission.soft-opt-in.notfound","error","No matching notification permission interstitial found for placement",{placement:t});var r='No matching notification permission interstitials ("'+t+'" placement) found for this tracking id - check filters on interstitials';o.debug(r),n(r)}))):"denied"===s?(o.info("Prompting for Interstitial with placement Notification Settings"),u.trace(e,"permission.soft-opt-in","info","Browser notification permissions have been denied. Displaying setting configuration interstitial"),i.displayInterstitial(e,l,{},(function(){}),p,(function(){u.trace(e,"permission.soft-opt-in.notfound","error","No matching notification settings interstitial found for placement",{placement:t});var r='No matching notification settings interstitials ("'+l+'" placement)  found for this tracking id - check filters on interstitials.';o.debug(r),n(r)}))):(u.trace(e,"permission.soft-opt-in","info","Permissions have already been granted before."),c["notification-prompt-yes"](e,n))}))}))}))},askForPermission:function(e,t,n,r){var i=a.isFunction(r)?r:a.isFunction(n)?n:void 0,s=n&&!a.isFunction(n)&&n.placement?n.placement:"Notification Prompt";if("notification"===t)return u.trace(e,"permission.ask","info",'Asking for "notification" permissions for web push with soft opt-in',{placement:s}),d._askForNotificationPermission(e,s,i);o.error("invalid permission"),r("invalid permission")}};t.exports={askForPermission:d.askForPermission}},{"../utils":40,"./event":26,"./logging":27,"./notification":28,"./push":31,"./tracing":35,"./tracking":36}],30:[function(e,t,n){var r=e("underscore"),i=e("./logging.js"),o=e("../platform/"),s=e("./event.js"),a=e("./tracing.js"),u=e("./tracking.js"),c=e("../platform/browser/xhr-queue.js"),l="Notification Prompt",d=["App Open","Feedback","Location Prompt","Location Settings","Manual Location Settings","Manual Notification Settings",l,"Notification Settings","Placement 1","Placement 2","Placement 3","Placement 4","Placement 5","Placement 6","Placement 7","Placement 8","Placement 9","Placement A","Placement B","Placement C","Placement D","Placement E","Placement F","Push Open","Store Launch"],p={_setupInterstitialEventHandlers:function(t,n,r,o){function a(){e("./session.js").setPhash(c.settings,c.phash),i.info("Pushed new phash.",c.phash),c=null}var u={},c={settings:t,phash:r},l=e("../utils/");return l.forEachInObject(o,(function(e,i){u[e]=function(o,u){var c=e.split(/\s+/),d=l.capitalize(c[0]),p=c[1];s.registerEvent(t,d,{id:p},null,r),(u=u||{}).pushPhash=a,u.meta=n,i(o,u)}})),u},_makePreloadHttpRequest:function(e,t,n,r,i){var o={placement:t};if(n&&n.displayGroup){var s=isNaN(parseInt(n.displayGroup,10))?void 0:parseInt(n.displayGroup,10);o.displayGroup=s}var a=e.server.contentEndpoint+"/"+e.data.app_key+"/"+u.getTrackingId(e)+"/interstitial/v2/fetch?preload=true";c.dispatchPostRequest(a,{data:o,asJson:!0,onSuccess:r,onError:i})},markInterstitialAsDisplayed:function(e,t){var n={phash:t.phash,templateId:t.templateid,splitId:t.splitid},r=e.server.contentEndpoint+"/"+e.data.app_key+"/"+u.getTrackingId(e)+"/interstitial/v2/mark-displayed";o.dispatchInternalEvent("Mark-Displayed"),c.dispatchPostRequest(r,{data:n,asJson:!0,onSuccess:function(){i.debug("Successfully marked interstitial as displayed.")},onError:function(t){i.error("Error marking interstitial as displayed.",t),e.onError&&e.onError(t)}})},_showCachedInterstitial:function(e,t,n,r,i){var a=o.getStoredValue("OL-Content-"+t);if(a){var u=JSON.parse(a),c=u.message.phash,l=JSON.parse(decodeURIComponent(u.message.messagecontent)),d=l.subject.replace(/\s+/g,"-").toLowerCase(),f=decodeURIComponent(l.html),g=p._setupInterstitialEventHandlers(e,l,c,i),h=o.showEmptyModal(["ol-interstitial",d],f,g,(function(){s.registerEvent(e,"Close",{},null,c),n&&n({meta:l})}));r&&r({phash:c,modal:h}),o.clearStoredValue("OL-Content-"+t),p.markInterstitialAsDisplayed(e,u.message)}},_preloadInterstitial:function(t,n,r,s,u,c,d){a.trace(t,"preload.preloadInterstitial","info","Beginning interstitial preload for placement.",{placement:n});var f=n===l;function g(l){if(i.debug("Received preload interstitial.",l),a.trace(t,"preload.preloadInterstitial","info","Received preload interstitial.",{message:l.message}),l&&l.message){var d={message:l.message};o.setStoredValue("OL-Content-"+n,JSON.stringify(d));var g=e("../utils/facade.js"),h=f?g.getAskForPermissionFacade(t,n):function(){p._showCachedInterstitial(t,n,s,u,r)},m=JSON.parse(decodeURIComponent(l.message.messagecontent)),v=decodeURIComponent(m.html);o.applyModalTrigger(t,v,h),o.dispatchInternalEvent("Preload-Complete")}else c&&c()}function h(e){i.error("Error getting interstitial.",e),t.onError&&t.onError(e)}var m=o.getStoredValue("OL-Content-"+n);if(m)a.trace(t,"preload.preloadInterstitial","info","No need to preload. Cached interstitial content found."),g(JSON.parse(m));else if(f){var v=e("./push.js");v.isPushSupported(t,(function(e){e&&v.getNotificationPermission(t,(function(e){a.trace(t,"preload.preloadInterstitial","info","Checking web push permissions before soft opt-in preload: permission = "+e),v.isSubscribedToPush(t,(function(r){r||"denied"===e?a.trace(t,"preload.preloadInterstitial","info","Not executing soft opt-in preload: isSubscribed = "+r+"; permission = "+e):(a.trace(t,"preload.preloadInterstitial","info","Executing soft opt-in HTTP call: isSubscribed = "+r+"; permission = "+e),p._makePreloadHttpRequest(t,n,d,g,h))}))}))}))}else a.trace(t,"preload.preloadInterstitial","info","Executing standard interstitial HTTP call."),p._makePreloadHttpRequest(t,n,d,g,h)},preloadInterstitials:function(e){var t=p._getPlacements(e);if(t){var n=t.indexOf(l);-1<n&&(t=t.splice(n,1).concat(t));var r=t.splice("2");for(var o in 0<r.length&&i.warn('The number of valid placements in "preloadContent" exceeds the preload limit of 2. The following placements will not be preloaded: '+r.join(", ")),t)p._preloadInterstitial(e,t[o])}},clearCachedInterstitials:function(e,t){a.trace(e,"preload.clearCachedInterstitials","info","Clearing cached interstitials.");for(var n=0;n<d.length;n++)o.clearStoredValue("OL-Content-"+d[n]);t&&t()},_getPlacements:function(e){var t=[],n=!0===e.preloadContent?[l]:r.isArray(e.preloadContent)?r.filter(e.preloadContent,(function(e){var n=r.contains(d,e);return n||t.push(e),n})):null;return 0<t.length&&i.warn('Invalid "preloadContent" placement(s): '+t.join(", ")),n},_hasCachedInterstitial:function(e,t){var n=o.getStoredValue("OL-Content-"+t);return a.trace(e,"preload.hasCachedInterstitial","info","Cached interstitial "+(n?"exists":"does not exist")+" for placement: "+t),null!==n},hasCachedInterstitials:function(e){var t=p._getPlacements(e);for(var n in t)if(!p._hasCachedInterstitial(e,t[n]))return!1;return null!==t&&0<t.length}};t.exports={hasCachedInterstitial:p._hasCachedInterstitial,hasCachedInterstitials:p.hasCachedInterstitials,clearCachedInterstitials:p.clearCachedInterstitials,preloadInterstitial:p._preloadInterstitial,preloadInterstitials:p.preloadInterstitials,markInterstitialAsDisplayed:p.markInterstitialAsDisplayed}},{"../platform/":24,"../platform/browser/xhr-queue.js":22,"../utils/":40,"../utils/facade.js":39,"./event.js":26,"./logging.js":27,"./push.js":31,"./session.js":33,"./tracing.js":35,"./tracking.js":36,underscore:3}],31:[function(e,t,n){var r,i,o=e("./logging.js"),s=e("../platform/"),a=e("./tracking.js"),u=e("../utils/"),c=e("../platform/browser/xhr-queue.js"),l=u.Promise;function d(e){return s.push.isHttpWebPushSupported().then((function(t){if(!e.crossOriginReceiverUrl||t)return s.push;if(!r){var n=e.crossOriginReceiverUrl;void 0!==e.tracingEnabled&&(n=u.updateUrlParameter(n,"tracingEnabled",e.tracingEnabled)),e.trace("push.configure","info","Web push subscription is managed on another domain. Loading remote page to communicate to in a hidden iframe.",n),r=s.iframeProxy.proxySenderObject(s.push,n,"push")}return r}))}function p(e,t,n){return new l((function(r,i){n.onSuccess=r,n.onError=i,e.call(c,t,n)}))}var f={isPushSupported:function(e,t){t=t||function(){},d(e).then((function(e){return e.isSupported()})).then(t,(function(n){e.onError(n),t()}))},subscribeToPush:function(e,t){if(e.subscriptionRetryCount||(e.subscriptionRetryCount=0),!e.vapidMigrationRunning||5<e.subscriptionRetryCount)e.trace("push.subscribeToPush","info","migration not running or retry limit exceeded. Proceeding with subscription"),i=(i=t)||function(){},d(r=e).then((function(e){r.trace("push.subscribe","info","Subscribing to push"),e.subscribe(r).then((function(t){var n=r.server.deliverabilityEndpoint+"/deliverability/appkey/"+r.data.app_key+"/trackingid/"+a.getTrackingId(r)+"/messagetype/browserpush",i={messageType:"browserpush",deliveryDetails:t};return r.trace("push.delivery-details","info","Sending delivery details to the API",{url:n,payload:i}),p(c.dispatchPutRequest,n,{data:i,asJson:!0}).then((function(n){return r.trace("push.delivery-details","info","Delivery details updated with the API",{response:n}),e.saveSubscriptionDetails(r,t).then((function(){return n}))}))})).then(i,(function(e){r.onError&&r.onError(e),r.trace("push.subscribe","error","Error occurred while subscribing to push",{error:e.message||e}),i()}))}));else{e.trace("push.subscribeToPush","info","waiting on migration routine. retry "+e.subscriptionRetryCount),e.subscriptionRetryCount=e.subscriptionRetryCount+1;var n=this;setTimeout((function(){n.subscribeToPush(e,t)}),1e3)}var r,i},unsubscribeFromPush:function(e,t){t=t||function(){},d(e).then((function(n){return e.trace("push.unsubscribe","info","Unsubscribing from push"),l.all([n.requiresDeliverabilityDelete(),n.unsubscribe(e)]).then((function(t){var r=t[0],i=t[1];if(r){if(i){var o=e.server.deliverabilityEndpoint+"/deliverability/appkey/"+e.data.app_key+"/trackingid/"+a.getTrackingId(e)+"/messagetype/browserpush";return e.trace("push.unsubscribe.remove-details","info","Removing delivery details for the tracking ID"),p(c.dispatchDeleteRequest,o,{asJson:!0}).then((function(){return n.removeSubscriptionDetails(e)}))}e.trace("push.unsubscribe.no-subscription-endpoint","info","Unsubscribe did not return a subscription endpoint")}else e.trace("push.unsubscribe.remove-details","info","Not removing delivery details because it is done by the browser on this platform")})).then(t,(function(n){e.onError&&e.onError(n),e.trace("push.unsubscribe","error","Error occurred while unsubscribing from push",{error:n.message}),t()}))}))},isSubscribedToPush:function(e,t){t=t||function(){},d(e).then((function(n){n.isSubscribed(e).then((function(n){e.trace("push.is-subscribed","info","Checked if subscribed to push: "+n,{subscribed:n}),t(n)}),(function(n){e.trace("push.is-subscribed","error","Error occurred while checking if subscribed to push",{error:n.message}),e.onError(n),t()}))}))},getNotificationPermission:function(e,t){t=t||function(){},d(e).then((function(n){n.getNotificationPermission(e).then((function(n){e.trace("push.permissions","info","Got notification permissions",n),t(n)}),(function(n){e.trace("push.permissions","error","Error while getting notification permissions",{error:n.message||n,stack:n.stack}),e.onError&&e.onError(n),t()}))}))},getLastNotificationPhash:function(e,t){var n;t=t||function(){},d(e).then((function(e){return(n=e).isSupported()})).then((function(e){if(e)return n.getLastPushMessage()})).then((function(t){if(t){var n;o.info("Found last browser push message. Extracting phash."),o.debug("Last browser push message is ",t);try{n=JSON.parse(t)}catch(t){o.warn("Could not parse last push message: ",t.stack)}if(n&&n.phash)return e.trace("push.notification-phash","info","Found phash from the last web push notification",n.phash),o.info("Extracted phash: "+n.phash),n.phash}})).then(t,(function(n){e.onError&&n&&e.onError(n),t()}))},setUpRemoteReceiver:function(){i=i||s.iframeProxy.proxyReceiverObject(s.push,"push")},updateTrackingId:function(e,t,n,r){r=r||function(){};var i=e.server.deliverabilityEndpoint+"/deliverability/appkey/"+e.data.app_key+"/trackingid/"+t+"/messagetype/browserpush/renameTrackingId?platform="+s.getBrowserName(),o={newTrackingId:n};e.trace("push.delivery-details","info","Updating tracking ID for delivery details",{old:t,new:n}),l.all([d(e),p(c.dispatchPostRequest,i,{data:o,asJson:!0})]).then((function(t){var r=t[0],i=t[1];return e.trace("push.delivery-details","info","Updated tracking ID for delivery details",{response:i}),r.saveRecipientDetails(e.data.app_key,n)})).then(r,(function(t){e.trace("push.delivery-details","error","Could not save recipient details",{error:t.message}),e.onError&&e.onError(t),r()}))},updateDeliverabilityStatus:function(e,t){var n,r=t||function(){};d(e).then((function(e){return(n=e).isSupported()})).then((function(t){if(t)return l.all([n.getNotificationPermission(e),n.isSubscribed(e),n.getSubscriptionDetails(e)]).then((function(t){var r=t[0],i=t[1],s=t[2],l=!!s,d="granted"!==r,f="granted"===r&&!i,g=e.multipleSubdomains,h=u.getHostname()===e.primarySubdomain,m=e.isUsingHttpSolution;if(l&&(d||f)&&(!g||g&&h||g&&m)){e.trace("push.update-deliverability-status","info","Tracking ID no longer deliverable - requesting deliverability deletion.",{subscription:s,permission:r,isSubscribed:i,subscriptionIsPresent:l,permissionsAreNotGranted:d,permissionsAreGrantedButNotSubscribed:f,isMultiSubdomain:g,isPrimarySubdomain:h,isUsingHttpSolution:m});var v=e.server.deliverabilityEndpoint+"/deliverability/appkey/"+e.data.app_key+"/trackingid/"+a.getTrackingId(e)+"/messagetype/browserpush/subscription",b=s;return p(c.dispatchDeleteRequest,v,{data:b,asJson:!0}).then(n.removeSubscriptionDetails).then((function(){o.info("Set as undeliverable: Tracking ID: "+a.getTrackingId(e)+" subscription: ",s),e.trace("push.update-deliverability-status","info","Has been set as undeliverable",{trackingId:a.getTrackingId(e),subscription:s,triggerConditions:{subscriptionIsPresent:l,permissionsAreNotGranted:d,permissionsAreGrantedButNotSubscribed:f}})}))}}))})).then(r,(function(t){e.onError&&e.onError(t),r()}))},migrateSubscription:function(e){var t;e.vapidMigrationRunning=!0,e.trace("push.migrateSubscription","info","Executing migration routine"),e.vapidPublicKey?d(e).then((function(e){return(t=e).supportsVAPIDWebPush()&&t.isSupported()})).then((function(n){return e.trace("push.migrateSubscription","info","push is supported: "+n),!!n&&t.isSubscribed(e)})).then((function(n){n?(e.trace("push.migrateSubscription","info","push is subscribed: "+n),t.getCurrentDeliveryDetails(e).then((function(n){var r,i,o,u,l;e.trace("push.migrateSubscription","info","retrieved current delivery details: "+JSON.stringify(n)),r=n,o=function(r){e.trace("push.migrateSubscription","info","is VAPID status: "+JSON.stringify(r.response)),!0!==r.response?t.unsubscribe(e).then((function(r){e.trace("push.migrateSubscription","info","executed unsubscribe for non vapid subscription: "),r?(e.trace("push.migrateSubscription","info","successfully unsubscribed"),t.subscribe(e).then((function(t){if(e.trace("push.migrateSubscription","info","executed subscribe using vapid key: "+JSON.stringify(t)),t){n.isVapid=!1,t.isVapid=!0;var r=e.server.deliverabilityEndpoint+"/deliverability/appkey/"+e.data.app_key+"/trackingid/"+a.getTrackingId(e)+"/messagetype/browserpush/migrate",i={oldDeliveryDetails:{messageType:"browserpush",deliveryDetails:n},newDeliveryDetails:{messageType:"browserpush",deliveryDetails:t}};return e.trace("push.migrateSubscription","info","sending migration request to deliverability API: "+r),s.setStoredValue("OL_VAPID_migration_on",(new Date).getTime()),e.vapidMigrationRunning=!1,p(c.dispatchPostRequest,r,{data:i,asJson:!0})}e.vapidMigrationRunning=!1,e.trace("push.migrate.subscribe","info","failed to create new VAPID key subscription.")}))):(e.vapidMigrationRunning=!1,e.trace("push.migrate.unsubscribe","info","failed to unsubscribe existing subscription."))})):(e.vapidMigrationRunning=!1,e.trace("push.migrate","info","already a VAPID subscription. No action needed."))},u=(i=e).server.deliverabilityEndpoint+"/deliverability/appkey/"+i.data.app_key+"/trackingid/"+a.getTrackingId(i)+"/messagetype/browserpush/vapidstatus",l={messageType:"browserpush",deliveryDetails:r},i.trace("push.migrateSubscription","info","requesting isVapid status check from deliverability API: "+u),c.dispatchPostRequest(u,{data:l,asJson:!0,onSuccess:o,onError:i.onError})}))):(e.vapidMigrationRunning=!1,e.trace("push.migrate","info","not subscribed to web push. No action needed."))})):(e.vapidMigrationRunning=!1,e.trace("push.migrate","info","No VAPID key is configured."))},readServiceWorkerTraceEvents:function(e){return d(e).then((function(e){return e.readTraceEvents()}))},getServiceWorkerConfig:function(e){return d(e).then((function(e){return e.getServiceWorkerConfig()}))},peekLastPushMessage:function(e){return d(e).then((function(e){return e.peekLastPushMessage()}))}};t.exports={migrateSubscription:f.migrateSubscription,isPushSupported:f.isPushSupported,subscribeToPush:f.subscribeToPush,unsubscribeFromPush:f.unsubscribeFromPush,isSubscribedToPush:f.isSubscribedToPush,getNotificationPermission:f.getNotificationPermission,getLastNotificationPhash:f.getLastNotificationPhash,peekLastPushMessage:f.peekLastPushMessage,setUpRemoteReceiver:f.setUpRemoteReceiver,updateTrackingId:f.updateTrackingId,updateDeliverabilityStatus:f.updateDeliverabilityStatus,readServiceWorkerTraceEvents:f.readServiceWorkerTraceEvents,getServiceWorkerConfig:f.getServiceWorkerConfig}},{"../platform/":24,"../platform/browser/xhr-queue.js":22,"../utils/":40,"./logging.js":27,"./tracking.js":36}],32:[function(e,t,n){var r=e("./logging.js"),i=e("./event.js"),o=e("./tracking.js"),s=e("../platform/browser/xhr-queue.js"),a={_expirationCheckTimeout:void 0,_messages:[],_meta:{total:0,unread:0},_onMessagesUpdatedCallback:void 0,_maxDelay:Math.pow(2,31)-1,_lastDisplayGroupUsed:void 0,_checkDisplayGroup:function(e,t){t!==a._lastDisplayGroupUsed&&(a._lastDisplayGroupUsed=t,0<a._messages.length&&a.clear(e))},_messagesSorter:function(e,t){return e.delivered_at>t.delivered_at||!(e.delivered_at<t.delivered_at)&&e.id>t.id?-1:1},_syncServer:function(e,t,n){var r=e.server.rimsEndpoint+"/"+e.data.app_key+"/"+o.getTrackingId(e)+"/rich/mailbox";t&&void 0!==t.displayGroup&&!isNaN(parseInt(t.displayGroup,10))?(r+="?displayGroup="+t.displayGroup,r+="&"):r+="?",r+="stateHash=";var i="";!function e(){s.dispatchGetRequest(r+i,{onSuccess:function(t){t?t.synchronisation_complete?n():(i=t.state_hash,setTimeout(e)):n(new Error("response is empty"))},onError:n})}()},_removeExpired:function(){for(var e=[],t=[],n=0,i=(new Date).getTime()/1e3,o=0;o<a._messages.length;o++){var s=a._messages[o];void 0!==s.end&&s.end<=i?(t.push(s),s.read||n++):e.push(s)}if(a._messages=e,a._meta.total-=t.length,a._meta.unread-=n,a._meta.total<a._messages.length){a._meta.total=a._messages.length;var u=0;for(o=0;o<a._messages.length;o++)u+=a._messages[o].read?0:1;a._meta.unread=u}r.debug("RIMS expired ",t.length+" messages."),0<t.length&&a._onMessagesUpdatedCallback&&a._onMessagesUpdatedCallback(a._messages,[],[],t,a._meta),a.scheduleExpirationCheck()},scheduleExpirationCheck:function(){var e;void 0!==a._expirationCheckTimeout&&(clearTimeout(a._expirationCheckTimeout),a._expirationCheckTimeout=void 0);for(var t=0;t<a._messages.length;t++){var n=a._messages[t];void 0!==n.end&&void 0===e&&(e=n.end),void 0!==n.end&&n.end<e&&(e=n.end)}if(void 0!==e){var i=e-(new Date).getTime()/1e3;i=i<0?0:i,a._meta.total<a._messages.length&&(i=0);var o=1e3*i;o=o>a._maxDelay?a._maxDelay:o,r.debug("RIMS expiration check in "+o/1e3+" sec"),a._expirationCheckTimeout=setTimeout(a._removeExpired,o)}},onMessagesUpdated:function(e,t){a._onMessagesUpdatedCallback=t},getNewMessages:function(e,t,n){var i=e.server.rimsEndpoint+"/"+e.data.app_key+"/"+o.getTrackingId(e)+"/rich/mailbox/messages",u=[];t&&void 0!==t.displayGroup&&!isNaN(parseInt(t.displayGroup,10))?(u.push(["displayGroup",t.displayGroup]),a._checkDisplayGroup(e,t.displayGroup)):a._checkDisplayGroup(e),0===a._messages.length?t&&t.limit&&u.push(["limit",t.limit]):u.push(["newerThan",a._messages[0].delivered_at]);for(var c=0;c<u.length;c++){var l=u[c];i+=(0===c?"?":"&")+l[0]+"="+l[1]}function d(t){if(t&&void 0!==t.items&&t.meta){if(r.info("Received "+t.items.length+" messages in rich inbox"),t.items){t.items.sort(a._messagesSorter);for(var i=0;i<t.items.length;i++)t.items[i].content&&(t.items[i].content=decodeURIComponent(t.items[i].content));a._messages=t.items.concat(a._messages)}a._meta={total:t.meta.total,unread:t.meta.unread},n&&n(t.items,a._meta),a._onMessagesUpdatedCallback&&a._onMessagesUpdatedCallback(a._messages,t.items,[],[],a._meta),a.scheduleExpirationCheck()}else e.onError&&e.onError(new Error("Malformed response from the Rich Inbox endpoint"))}function p(t){r.error("Error getting Rich Inbox messages",t),e.onError&&e.onError(t),a.scheduleExpirationCheck()}a._syncServer(e,t,(function(e){e?p(e):s.dispatchGetRequest(i,{onSuccess:d,onError:p})}))},getMoreMessages:function(e,t,n){if(0===a._messages.length)return a.getNewMessages(e,t,n);var i=e.server.rimsEndpoint+"/"+e.data.app_key+"/"+o.getTrackingId(e)+"/rich/mailbox/messages",u=[];t&&void 0!==t.displayGroup?(u.push(["displayGroup",t.displayGroup]),a._checkDisplayGroup(e,t.displayGroup)):a._checkDisplayGroup(e),0<a._messages.length&&u.push(["olderThan",a._messages[a._messages.length-1].delivered_at]);for(var c=0;c<u.length;c++){var l=u[c];i+=(0===c?"?":"&")+l[0]+"="+l[1]}s.dispatchGetRequest(i,{onSuccess:function(t){if(t&&void 0!==t.items&&t.meta){if(r.info("Received "+t.items.length+" messages in rich inbox"),t.items){t.items.sort(a._messagesSorter);for(var i=0;i<t.items.length;i++)t.items[i].content&&(t.items[i].content=decodeURIComponent(t.items[i].content));a._messages=a._messages.concat(t.items)}a._meta={total:t.meta.total,unread:t.meta.unread},n&&n(t.items,a._meta),a._onMessagesUpdatedCallback&&a._onMessagesUpdatedCallback(a._messages,t.items,[],[],a._meta),a.scheduleExpirationCheck()}else e.onError&&e.onError(new Error("Malformed response from the Rich Inbox endpoint"))},onError:function(t){r.error("Error getting Rich Inbox messages",t),e.onError&&e.onError(t),a.scheduleExpirationCheck()}})},getMessages:function(e,t){t&&t(a._messages,a._meta)},markAsRead:function(e,t,n){var u=e.server.rimsEndpoint+"/"+e.data.app_key+"/"+o.getTrackingId(e)+"/rich/mailbox/messages/"+t;s.dispatchPutRequest(u,{data:{read:!0},asJson:!0,onSuccess:function(){for(var o,s=!1,u=0;u<a._messages.length;u++){var c=a._messages[u];if(c.id===t){s=1===c.read,c.read=1,o=c,s||a._meta.unread--;break}}var l=s?"Re-Read":"Read",d=s?"Rich Message "+t+" Re-Read":"Rich Message "+t+" Opened";if(i.registerEvent(e,l,d,null,o?o.phash:void 0),r.info("Marked message "+t+" as "+l+"."),n&&n(o),a._onMessagesUpdatedCallback){var p=[];o&&p.push(o),a._onMessagesUpdatedCallback(a._messages,[],p,[],a._meta)}a.scheduleExpirationCheck()},onError:function(t){r.error("Error marking Rich Inbox message as read",t),e.onError&&e.onError(t),a.scheduleExpirationCheck()}})},markAsDeleted:function(t,n,u){var c=t.server.rimsEndpoint+"/"+t.data.app_key+"/"+o.getTrackingId(t)+"/rich/mailbox/messages/"+n;s.dispatchPutRequest(c,{data:{deleted:!0},asJson:!0,onSuccess:function(){for(var o,s=0;s<a._messages.length;s++){var c=a._messages[s];if(c.id===n){o=c,a._meta.total--,c.read||a._meta.unread--;break}}if(o){var l=e("../utils/");a._messages=l.arrayRemove(a._messages,o)}if(i.registerEvent(t,"Delete","Rich Message "+n+" Deleted",null,o?o.phash:void 0),r.info("Marked message "+n+" as deleted."),u&&u(o),a._onMessagesUpdatedCallback){var d=[];o&&d.push(o),a._onMessagesUpdatedCallback(a._messages,[],[],d,a._meta)}a.scheduleExpirationCheck()},onError:function(e){r.error("Error marking Rich Inbox message as deleted",e),t.onError&&t.onError(e),a.scheduleExpirationCheck()}})},setMessages:function(e,t){a._messages=t||[];for(var n=0,r=0;r<a._messages.length;r++)a._messages[r].read||n++;a._meta={total:a._messages.length,unread:n}},clear:function(e){r.logLevel=e.logLevel;var t=a._messages;a._messages=[],a._meta={total:0,unread:0},a._onMessagesUpdatedCallback&&a._onMessagesUpdatedCallback(a._messages,[],[],t,a._meta),r.debug("Cleared RIMS messages")},_clearLastDisplayGroupUsed:function(){a._lastDisplayGroupUsed=void 0}};t.exports={getNewMessages:a.getNewMessages,getMoreMessages:a.getMoreMessages,getMessages:a.getMessages,onMessagesUpdated:a.onMessagesUpdated,setMessages:a.setMessages,markAsRead:a.markAsRead,markAsDeleted:a.markAsDeleted,clear:a.clear,_clearLastDisplayGroupUsed:a._clearLastDisplayGroupUsed}},{"../platform/browser/xhr-queue.js":22,"../utils/":40,"./event.js":26,"./logging.js":27,"./tracking.js":36}],33:[function(e,t,n){var r=e("./logging.js"),i=e("../platform/"),o=e("../utils/"),s=e("./push.js"),a=e("./tracing.js"),u=e("./tracking.js"),c=e("../platform/browser/xhr-queue.js"),l={startSession:function(e,t){s.getLastNotificationPhash(e,(function(n){r.debug("Checking for a phash",n),n&&r.debug("phash "+n+" found"),l.startSessionWithPhash(e,n,t)}))},startSessionWithPhash:function(e,t,n){a.trace(e,"session.startSessionWithPhash","info","Push phash value is "+t,t),l._sessionRefreshInterval&&(clearInterval(l._sessionRefreshInterval),l._sessionRefreshInterval=null);var d,p,f,g=i.getStoredValue("OL_Session_Id"),h=g?i.getStoredValue("OL_Phash"):null;a.trace(e,"session.startSessionWithPhash","info","Stored phash value.",h);var m,v=i.getOLParametersFromQueryString();d=v.sessionId,p=v.trackingId,f=v.phash,p||f||(f=i.getPhashFromHashFragment(e.phashTag)),a.trace(e,"session.startSessionWithPhash","info","URL phash value is "+f,f),f=f||t,d&&m!==d?(m=d,i.setStoredValue("OL_Session_Id",m)):m=g;var b=!m||f&&h!==f;e.data.sid=m&&!b?m:o.generateUUID(),e.data.session_length=0,e.data.average_session_length=0,e.data.phash=f||h,b&&k(e.data.sid,e.data.phash);var y=u.getTrackingId(e);if(p&&y!==p){var _=o.getLongTermExpiry();e.data.prev_tracking_id=y,i.setStoredValue("OL_Prev_Tracking_ID",y,_),e.data.tracking_id=p,i.setStoredValue("OL_Tracking_ID",p,_)}function w(){var t=i.getStoredValue("OL_Session_Id"),n=i.getStoredValue("OL_Phash");l._sessionRefreshInterval&&null===t&&0<e.sessionExpirationSeconds?(clearInterval(l._sessionRefreshInterval),l._sessionRefreshInterval=null,l.startSession(e)):k(t,n)}function S(){!l._sessionRefreshInterval&&0<e.sessionExpirationSeconds&&(l._sessionRefreshInterval=setInterval(w,1e4))}function k(t,n){var o=new Date((new Date).getTime()+1e3*e.sessionExpirationSeconds);r.debug("Setting session expiration on: "+o),0<e.sessionExpirationSeconds?(null!==t&&(e.data.sid=t),a.trace(e,"session.storePhash","info","Storing phash.",n),i.setStoredValue("OL_Session_Id",e.data.sid,o),i.setStoredValue("OL_Phash",n,o)):(a.trace(e,"session.storePhash","info","Clearing session ID and phash."),i.clearStoredValue("OL_Session_Id"),i.clearStoredValue("OL_Phash"))}if(e.sessionStart=(new Date).getTime(),w(),s.updateDeliverabilityStatus(e),r.info("startSession",e.data.sid),b){a.trace(e,"session.start","info","Using new generated session.",e.data.sid),r.debug("new session id: "+e.data.sid+" old session id: "+m+" new tracking id: "+u.getTrackingId(e)+" old tracking id: "+e.data.prev_tracking_id+" new phash: "+e.data.phash+" old phash: "+h);var E=e.server.apiEndpoint+"/session";c.dispatchPostRequest(E,{data:e.data,onSuccess:function(t){a.trace(e,"session.start","info","Session updated with the API.",{endpoint:e.server.apiEndpoint+"/session",response:t}),S(),n&&n(t,b)},onError:function(t){a.trace(e,"session.error","error","Error while sending a session start request to the API",t),e.onError&&e.onError(t)}})}else a.trace(e,"session.continue","info","Reusing stored session",e.data.sid),S(),n&&n(null,b);a.trace(e,"session.ready","info","Phash for session is "+e.data.phash,e.data.phash)},getSessionId:function(e){return e.data.sid},endSession:function(e,t){if(!e.data.sid)return a.trace(e,"session.end","info","endSession called, but no active session found. Ignoring."),void r.info("endSession ignored as no active session");r.info("endSession",e.data.sid),a.trace(e,"session.end","info","Ending session",e.data.sid),e.data.session_length=(new Date).getTime()-(e.sessionStart||0);var n=i.getStoredValue("OL_Session_Count"),s=i.getStoredValue("OL_Total_Session_Length");n&&s?(n=parseInt(n)+1,s=parseInt(s)+e.data.session_length,e.data.average_session_length=Math.ceil(s/n),i.setStoredValue("OL_Session_Count",n,o.getLongTermExpiry()),i.setStoredValue("OL_Total_Session_Length",s,o.getLongTermExpiry())):(e.data.average_session_length=e.data.session_length,i.setStoredValue("OL_Session_Count",1,o.getLongTermExpiry()),i.setStoredValue("OL_Total_Session_Length",e.data.session_length,o.getLongTermExpiry()));var u=e.server.apiEndpoint+"/session/end";c.dispatchPostRequest(u,{data:e.data,onSuccess:function(n){delete e.data.sid,delete e.data.phash,delete e.data.prev_tracking_id,i.setStoredValue("OL_Prev_Tracking_ID",null),clearInterval(l._sessionRefreshInterval),i.setStoredValue("OL_Session_Id",null),i.setStoredValue("OL_Phash",null),t&&t(n)},onError:e.onError})},setPhash:function(e,t){e.data.phash=t;var n=new Date((new Date).getTime()+1e3*e.sessionExpirationSeconds);a.trace(e,"session.set-phash","info","Setting phash.",e.data.phash),i.setStoredValue("OL_Phash",e.data.phash,n)}};t.exports={startSession:l.startSession,getSessionId:l.getSessionId,endSession:l.endSession,setPhash:l.setPhash}},{"../platform/":24,"../platform/browser/xhr-queue.js":22,"../utils/":40,"./logging.js":27,"./push.js":31,"./tracing.js":35,"./tracking.js":36}],34:[function(e,t,n){var r=e("./logging.js"),i=e("./tracking.js"),o=e("../platform/browser/xhr-queue.js"),s={setTag:function(e,t,n,s,a){r.info("setTag",t,n,s);var u={trackingid:i.getTrackingId(e),appkey:e.data.app_key,name:t,type:s,value:n},c=e.server.tagsEndpoint+"/";o.dispatchPostRequest(c,{data:u,asJson:!0,onSuccess:a,onError:e.onError})},batchSetTag:function(e,t,n){r.info("setTags",t);var s={trackingid:i.getTrackingId(e),appkey:e.data.app_key,tags:t},a=e.server.tagsEndpoint+"/";o.dispatchPostRequest(a,{data:s,asJson:!0,onSuccess:n,onError:e.onError})},getTag:function(e,t,n){var r=e.server.tagsEndpoint+"/apps/"+e.data.app_key+"/tracking/"+i.getTrackingId(e)+"/tag/"+t;o.dispatchGetRequest(r,{onSuccess:n,onError:e.onError})}};t.exports={setTag:s.setTag,getTag:s.getTag,batchSetTag:s.batchSetTag}},{"../platform/browser/xhr-queue.js":22,"./logging.js":27,"./tracking.js":36}],35:[function(e,t,n){var r=e("../platform/index.js"),i=e("../utils/index.js"),o=e("./logging.js"),s=e("../utils/browserpush.js"),a=e("./push.js"),u=r.push,c=i.Promise,l="OL_WEB_DEVICE_ID";function d(e,t){return e.timestamp-t.timestamp}var p={_lastEventTimestamp:void 0,_traceCache:[],_traceDb:null,_getTraceDB:function(){return!p._traceDb&&s.isIndexedDBSupported()&&(p._traceDb=new s.IndexedDBWrapper("ol-jssdk-trace-events",1,{autoIncrement:!0})),p._traceDb},_addToCache:function(e){var t=p._getTraceDB();return t?t.add(JSON.stringify(e)).then((function(){}),(function(e){o.error("Could not add trace event to IndexedDB: "+e.message)})):(p._traceCache.push(e),c.resolve())},_getCachedItems:function(){var e=p._getTraceDB();return e?e.getAll().then((function(e){return e.map((function(e){return JSON.parse(e)}))})):c.resolve(p._traceCache.concat([]))},_clearCachedItems:function(){var e=p._getTraceDB();return e?e.clear().catch((function(e){o.error("Could not remove trace event from IndexedDB: "+e.message)})):(p._traceCache.splice(0,p._traceCache.length),c.resolve())},_outputTraceEvents:function(e){e.forEach((function(e){var t=new Date(e.timestamp),n="["+e.tag+"] "+t+" : "+e.description;o.trace(n,e.meta)})),0<e.length&&(p._lastEventTimestamp=e[e.length-1].timestamp)},_traceOutputPoller:function(e){p.readCachedTraceEvents(e,{afterTimestamp:p._lastEventTimestamp}).then((function(e){e&&p._outputTraceEvents(e)})),p._tracerEnabled&&setTimeout((function(){p._traceOutputPoller(e)}),1e3)},enableTracing:function(e){return p._setUpTracingId().then((function(){p._tracerEnabled=!0,p._lastEventTimestamp=(new Date).getTime(),p._traceOutputPoller(e)}),(function(e){o.error("Unexpected error while enabling tracing: "+e.message),p._tracerEnabled=!0}))},disableTracing:function(){return p._tracerEnabled=!1,u.isSupported().then((function(e){if(e)return u.setTracingDisabled().then(void 0,(function(e){o.error("Could not remove tracer enabled key for web push worker: "+e.message)}))}),(function(e){o.error("Could not get web push support information because of error: "+e.message)}))},clearTraceEvents:function(){return u.isSupported().then((function(e){return(e?u.clearTraceEvents():c.resolve()).then(p._clearCachedItems,(function(e){return o.error("Could not clear trace events from worker: "+e.message),p._clearCachedItems()}))}),(function(e){o.error("Could not get web push support information because of error: "+e.message)}))},trace:function(e,t,n,r,i){if(!p._tracerEnabled)return c.resolve();var o,s=(new Date).getTime();try{o=JSON.parse(JSON.stringify(void 0===i?{}:i))}catch(e){o="[could not convert to JSON]"}return p._addToCache({webDeviceId:p._tracingId,timestamp:s,tag:t,severity:n,description:r,meta:o})},readCachedTraceEvents:function(e,t){var n=t&&t.afterTimestamp?t.afterTimestamp:0,r=a.readServiceWorkerTraceEvents(e).then(void 0,(function(e){return o.error("Could not read events from push worker: "+e.message),[]})),s=p._getCachedItems().then(void 0,(function(e){return o.error("Could not read cached events: "+e.message),[]}));return c.all([r,s]).then((function(e){var t,r=e[0],o=e[1].concat(r);return o.sort(d),i.filter(o,(t=n,function(e){return e&&e.timestamp&&e.timestamp>t}))}))},_setUpTracingId:function(){var e=r.getStoredValue(l);return e||(e=i.generateUUID(),r.setStoredValue(l,e,i.getLongTermExpiry())),p._tracingId=e,i.isHTTPS()||i.isLocalhost()?(o.debug("Setting up tracing for push"),u.isSupported().then((function(t){if(t)return u.setTracingId(e).then((function(){return u.setTracingEnabled().then(void 0,(function(e){o.error("Could not set tracer enabled key for web push worker: "+e.message)}))}),(function(e){o.error("Could not set tracer tracingId for web push worker: "+e.message)}))}),(function(e){o.error("Could not get web push support information because of error: "+e.message)}))):(o.debug("Not setting up tracing for push because the page is not loaded via HTTPS"),c.resolve())}};t.exports={trace:p.trace,enableTracing:p.enableTracing,disableTracing:p.disableTracing,readCachedTraceEvents:p.readCachedTraceEvents,clearTraceEvents:p.clearTraceEvents}},{"../platform/index.js":24,"../utils/browserpush.js":38,"../utils/index.js":40,"./logging.js":27,"./push.js":31}],36:[function(e,t,n){var r=e("../platform/"),i={getTrackingId:function(e){return r.getStoredValue("OL_Tracking_ID")||e&&e.data.tracking_id},setTrackingId:function(t,n,o){e("./logging.js").info("setTrackingId",n);var s=i.getTrackingId(t);t.data.prev_tracking_id=s;var a=e("../utils/");r.setStoredValue("OL_Prev_Tracking_ID",s,a.getLongTermExpiry()),t.data.tracking_id=n,r.setStoredValue("OL_Tracking_ID",n,a.getLongTermExpiry()),e("./tracing.js").trace(t,"tracking.setTrackingId","info","Set tracking ID.",{old:s,new:n});var u=e("../platform/browser/xhr-queue.js"),c=t.server.apiEndpoint+"/session/tracking_id";u.dispatchPostRequest(c,{data:t.data,onSuccess:o,onError:t.onError})}};t.exports={getTrackingId:i.getTrackingId,setTrackingId:i.setTrackingId}},{"../platform/":24,"../platform/browser/xhr-queue.js":22,"../utils/":40,"./logging.js":27,"./tracing.js":35}],37:[function(e,t,n){var r={apiEndpoint:"https://js-api.otherlevels.com/0.8",tagsEndpoint:"https://js-tags.otherlevels.com/api",mdnEndpoint:"https://js-mdn.otherlevels.com",contentEndpoint:"https://js-content.otherlevels.com",rimsEndpoint:"https://js-rich.otherlevels.com",deliverabilityEndpoint:"https://js-deliverability-api.otherlevels.com",jsSdkService:"https://safari.otherlevels.com"},i="<js-sdk-service.injected.vapidPublicKey>",o={chrome:"width=450,height=250,location=0,status=0,top=0",default:"width=530,height=270,location=0,status=0,top=0"},s={refreshSettings:function(t,n,s,a){var u=e("underscore"),c=e("../platform"),l=e("../services/logging"),d=e("../utils"),p=e("../services/tracing");(null==i||0<=i.indexOf("<js-sdk-service"))&&(i=void 0),s=s||{},a=a||{};var f=o[c.getBrowserName()];f=f||o.default;var g=d.extend(a.data||{},{app_key:n,app_name:s.appName||"(unknown)",lv:t});d.extend(a,{data:g,server:r,multipleSubdomains:s.multipleSubdomains,primarySubdomain:s.primarySubdomain,dataMigrationSubdomain:s.dataMigrationSubdomain,vapidPublicKey:s.vapidPublicKey||i,logLevel:s.logLevel||l.LOG_LEVELS.warn,android:{isFirstLaunch:!0,activityCount:0},sessionExpirationSeconds:void 0===s.sessionExpiration?900:s.sessionExpiration,onError:s.onError||void 0,popupOptions:s.popupOptions||f,permissionUrls:{notificationYes:s.notificationYesUrl||void 0},permissionSettingsUrls:{chrome:s.chromeSettingsUrl||"https://support.google.com/chrome/answer/3220216?hl=en",firefox:s.firefoxSettingsUrl||"https://support.mozilla.org/en-US/products/firefox"},crossOriginReceiverUrl:s.crossOriginReceiverUrl,isUsingHttpSolution:void 0!==s.crossOriginReceiverUrl,crossOriginReceiverMode:s.crossOriginReceiverMode,safariWebsitePushId:s.safariWebsitePushId,preloadContent:s.preloadContent,serviceWorkerLocation:s.serviceWorkerLocation||"/ol-service-worker.js",tracingEnabled:s.tracingEnabled}),void 0===s.preloadContent||u.isArray(s.preloadContent)||l.warn('Specifying a type other than Array for "preloadContent" has been deprecated. Support for deprecated types may be removed in a future release.'),a.serviceWorkerScope=s.serviceWorkerScope||d.getServiceWorkerScopeFromLocation(a.serviceWorkerLocation),s.phashTag&&(a.phashTag=s.phashTag),l.logLevel=a.logLevel;var h=d.getLongTermExpiry();if(a.data.tracking_id=c.getStoredValue("OL_Tracking_ID"),!a.data.tracking_id){var m="@OL@"+d.generateUUID().replace(/-/g,"").substring(4);a.data.tracking_id=m,c.setStoredValue("OL_Tracking_ID",m,h)}c.getStoredValue("OL_Prev_Tracking_ID")&&(a.data.prev_tracking_id=c.getStoredValue("OL_Prev_Tracking_ID")),a.data.lit=c.getStoredValue("OL_LIB_INSTALL_TIME"),a.data.lit||(a.data.lit=""+(new Date).getTime(),c.setStoredValue("OL_LIB_INSTALL_TIME",a.data.lit,h)),a.data.acit=c.getStoredValue("OL_APP_CLEAN_INSTALL_TIME"),a.data.acit||(a.data.acit=""+(new Date).getTime(),c.setStoredValue("OL_APP_CLEAN_INSTALL_TIME",a.data.acit,h)),a.data.session_length=0,a.data.average_session_length=0;var v=c.platformSettings();return d.extend(a,v),"true"!==c.getStoredValue("OL_TraceEnabled")||!1!==a.tracingEnabled&&void 0!==a.tracingEnabled||(a.tracingEnabled=!0),!0===a.tracingEnabled?(p.enableTracing(a),p.trace(a,"tracer.enabled","info","Tracer enabled on page",location)):!1===a.tracingEnabled&&p.disableTracing(a),p.trace(a,"settings.init","info","Settings refreshed",a),a.trace=function(e,t,n,r){return p.trace(this,e,t,n,r)}.bind(a),a.safariWebsitePushId||l.debug("safariWebsitePushId is not defined. Web push will not be available in Safari."),a}};t.exports={refreshSettings:s.refreshSettings}},{"../platform":24,"../services/logging":27,"../services/tracing":35,"../utils":40,underscore:3}],38:[function(e,t,n){var r=new RegExp("(googleapis|/gcm/|/fcm/)","i"),i={isFirefox:function(e){return!r.test(e.endpoint)},isChrome:function(e){return r.test(e.endpoint)},getDeliveryDetails:function(e){if(!e)return{};if(i.isFirefox(e)){var t=e.getKey("p256dh"),n=e.getKey("auth");return{platform:"firefox",subscriptionUrl:e.endpoint,clientKey:btoa(String.fromCharCode.apply(null,new Uint8Array(t))),clientAuth:btoa(String.fromCharCode.apply(null,new Uint8Array(n)))}}if(i.isChrome(e)){var r={platform:"chrome",subscriptionUrl:e.endpoint,p256dh:"",auth:""};if(e.getKey&&e.getKey("p256dh")){var o=e.getKey("p256dh"),s=e.getKey("auth");r.p256dh=btoa(String.fromCharCode.apply(null,new Uint8Array(o))),r.auth=btoa(String.fromCharCode.apply(null,new Uint8Array(s)))}return r}return{}},promisifyIDBRequest:function(e){return new Promise((function(t,n){function r(){t(e.result),o()}function i(){n(e.error),o()}function o(){e.removeEventListener("complete",r),e.removeEventListener("success",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)}e.addEventListener("complete",r),e.addEventListener("success",r),e.addEventListener("error",i),e.addEventListener("abort",i)}))},safeToJson:function(e){try{return JSON.stringify(e)}catch(e){return"<could-not-be-presented-as-json>"}},promisedParseJSON:function(e){try{return Promise.resolve(JSON.parse(e))}catch(t){return Promise.reject(new Error('Could not parse string "'+e+'": '+t.message))}},generateMessageId:function(){return"message-"+(new Date).getTime()+"-"+parseInt(1e4*Math.random(),10)},isIndexedDBSupported:function(){return self.indexedDB&&self.IDBObjectStore&&self.IDBObjectStore.prototype.add&&self.IDBObjectStore.prototype.clear&&self.IDBObjectStore.prototype.getAll}};function o(e,t,n){this.dbStoreName=e+"-store";var r=self.indexedDB;if(r){var o=r.open(e,t);this.ready=i.promisifyIDBRequest(o),o.onupgradeneeded=function(){o.result.createObjectStore(this.dbStoreName,n)}.bind(this)}}o.prototype.transaction=function(e,t,n){return this.ready.then((function(r){var o="readonly";t.apply?n=t:t&&(o=t);var s,a=r.transaction(e,o),u=n(a,r),c=i.promisifyIDBRequest(a);return u?(s=u[0]&&"result"in u[0]?Promise.all(u.map(i.promisifyIDBRequest)):i.promisifyIDBRequest(u),c.then((function(){return s}))):c}))},o.prototype.get=function(e){try{var t=this.dbStoreName;return this.transaction(t,(function(n){return n.objectStore(t).get(e)}))}catch(e){return Promise.reject(e)}},o.prototype.getAll=function(){try{var e=this.dbStoreName;return this.transaction(e,(function(t){return t.objectStore(e).getAll()}))}catch(e){return Promise.reject(e)}},o.prototype.add=function(e){try{var t=this.dbStoreName;return this.transaction(t,"readwrite",(function(n){n.objectStore(t).add(e)}))}catch(e){return Promise.reject(e)}},o.prototype.put=function(e,t){try{var n=this.dbStoreName;return this.transaction(n,"readwrite",(function(r){r.objectStore(n).put(t,e)}))}catch(e){return Promise.reject(e)}},o.prototype.delete=function(e){try{var t=this.dbStoreName;return this.transaction(t,"readwrite",(function(n){n.objectStore(t).delete(e)}))}catch(e){return Promise.reject(e)}},o.prototype.clear=function(){try{var e=this.dbStoreName;return this.transaction(e,"readwrite",(function(t){t.objectStore(e).clear()}))}catch(e){return Promise.reject(e)}},t.exports={getDeliveryDetails:i.getDeliveryDetails,safeToJson:i.safeToJson,promisedParseJSON:i.promisedParseJSON,generateMessageId:i.generateMessageId,IndexedDBWrapper:o,isIndexedDBSupported:i.isIndexedDBSupported,tracingIdStorageKey:"OL_WEB_DEVICE_ID",tracingEnabledKey:"ol_tracing_enabled",traceDbName:"ol-service-worker-trace-events",lastMessageReceivedKey:"last_message_received"}},{}],39:[function(e,t,n){var r=e("../services/permission"),i={getAskForPermissionFacade:function(e,t){var n={placement:t};return function(){r.askForPermission(e,"notification",n,(function(){}))}}};t.exports={getAskForPermissionFacade:i.getAskForPermissionFacade}},{"../services/permission":29}],40:[function(e,t,n){var r=e("underscore"),i=e("uuid"),o=e("yaku/lib/yaku.core"),s={_Promise:void 0!==window.Promise&&-1!==window.Promise.toString().indexOf("[native code]")?window.Promise:o,generateUUID:function(){return i.v4()},getLongTermExpiry:function(){return new Date((new Date).setFullYear((new Date).getFullYear()+50))},extend:function(e,t){if(null===t||"object"!=typeof t)return t;for(var n in t)t.hasOwnProperty(n)&&("object"!=typeof t[n]||r.isArray(t[n])?e[n]=t[n]:(void 0===e[n]&&(e[n]={}),s.extend(e[n],t[n])));return e},getDeep:function(e,t){for(var n=(t||"").split("."),r=e;void 0!==r&&0!==n.length;){var i=n.shift();try{r=r[i]}catch(e){r=void 0;break}}return r},arrayRemove:function(e,t){if(void 0!==e){var n=s.arrayIndexOf(e,t);if(n<0)return e;var r=e.slice(n+1||e.length);return e.length=n,Array.prototype.push.apply(e,r),e}},arrayIndexOf:function(e,t){if(void 0===e)return-1;for(var n=-1,r=0;r<e.length;r++)if(e[r]===t){n=r;break}return n},forEachInObject:function(e,t){if(void 0!==e)for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},toISOString:function(e){function t(e){return e<10?"0"+e:e}return e.toISOString?e.toISOString():e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},deepCopy:function(e){return JSON.parse(JSON.stringify(e))},updateUrlParameter:function(e,t,n){var r=e.indexOf("#"),i=-1===r?"":e.substr(r);e=-1===r?e:e.substr(0,r);var o=new RegExp("([?&])"+t+"=.*?(&|$)","i"),s=-1!==e.indexOf("?")?"&":"?";return n?e=e.match(o)?e.replace(o,"$1"+t+"="+n+"$2"):e+s+t+"="+n:("?"===(e=e.replace(new RegExp("([?&]?)"+t+"=[^&]*","i"),"")).slice(-1)&&(e=e.slice(0,-1)),-1===e.indexOf("?")&&(e=e.replace(/&/,"?"))),e+i},isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)},filter:function(e,t){if(e.filter)return e.filter(t);for(var n=e.length,r=[],i=0;i<n;i++){var o=e[i];t(o)&&r.push(o)}return r},isHTTPS:function(){try{return/^https/.test(window.location.protocol)}catch(e){return!1}},isLocalhost:function(){try{return"localhost"===window.location.hostname}catch(e){return!1}},getHostname:function(){try{return window.location.hostname}catch(e){return""}},isTopWindow:function(){try{return window.top===window.self}catch(e){return!0}},getPageUrl:function(){try{return window.location.href}catch(e){return"unknown"}},getValidTrackingId:function(t){return"string"==typeof t?t:"number"==typeof t?(e("../services/logging.js").info("v1.10.0 WARNING: OL ID was supplied as number type. Please supply as string type."),t.toString()):void 0},getServiceWorkerScopeFromLocation:function(e,t){if(!e||"string"!=typeof e||!e.trim())return"/";var n=e.trim().replace(/\/$/,"");if(/^\//.test(n))return n.replace(/(.*\/).*/,"$1");var r=(t||window.location.pathname).replace(/(.*\/).*/,"$1");if(/^\.\./.test(n)){var i=n.split("../").length-1,o=r.split("/");return o.slice(0,o.length-i-1).join("/")+"/"}return r},executeWithPromise:function(e){return new s._Promise((function(t,n){var r=!1;function i(e){r||(r=!0,t(e))}var o=e(i);o&&o.then&&"function"==typeof o.then&&o.then(i,n)}))},urlBase64ToUint8Array:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new window.Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}};t.exports={generateUUID:s.generateUUID,extend:s.extend,getDeep:s.getDeep,arrayRemove:s.arrayRemove,arrayIndexOf:s.arrayIndexOf,forEachInObject:s.forEachInObject,capitalize:s.capitalize,toISOString:s.toISOString,deepCopy:s.deepCopy,updateUrlParameter:s.updateUrlParameter,isFunction:s.isFunction,filter:s.filter,isHTTPS:s.isHTTPS,isLocalhost:s.isLocalhost,isTopWindow:s.isTopWindow,getPageUrl:s.getPageUrl,getHostname:s.getHostname,getValidTrackingId:s.getValidTrackingId,getLongTermExpiry:s.getLongTermExpiry,getServiceWorkerScopeFromLocation:s.getServiceWorkerScopeFromLocation,Promise:s._Promise,executeWithPromise:s.executeWithPromise,urlBase64ToUint8Array:s.urlBase64ToUint8Array}},{"../services/logging.js":27,underscore:3,uuid:4,"yaku/lib/yaku.core":9}]},{},[10])}).call(this,n(122))}}]);
//# sourceMappingURL=134.7e423a7d7c5ba37bf32bb42c4af33ff8.js.map